<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ouroboros.Consensus.Block.Forge</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Ouroboros.Consensus.Block.Forge.html">Source</a></li><li><a href="&quot;../index.html&quot;">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ouroboros-consensus-0.1.0.0: Consensus layer for the Ouroboros blockchain protocol</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Ouroboros.Consensus.Block.Forge</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">MaintainForgeState</a></li><li><a href="#g:2">Infrastructure for dealing with state updates</a></li></ul></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">class</span> (<a href="Ouroboros-Consensus-Util-IOLike.html#t:NoUnexpectedThunks" title="Ouroboros.Consensus.Util.IOLike">NoUnexpectedThunks</a> (<a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> blk), <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> blk)) &#8658; <a href="#t:CanForge">CanForge</a> blk <span class="keyword">where</span><ul class="subs"><li><span class="keyword">type</span> <a href="#t:ForgeState">ForgeState</a> blk &#8759; &#9733;</li><li><a href="#v:forgeBlock">forgeBlock</a> &#8759; <a href="Ouroboros-Consensus-Util-Random.html#t:MonadRandom" title="Ouroboros.Consensus.Util.Random">MonadRandom</a> m &#8658; <a href="Ouroboros-Consensus-Config.html#t:TopLevelConfig" title="Ouroboros.Consensus.Config">TopLevelConfig</a> blk &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> blk &#8594; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/Cardano-Slotting-Block.html#t:BlockNo" title="Cardano.Slotting.Block">BlockNo</a> &#8594; <a href="Ouroboros-Consensus-Ledger-Abstract.html#t:TickedLedgerState" title="Ouroboros.Consensus.Ledger.Abstract">TickedLedgerState</a> blk &#8594; [<a href="Ouroboros-Consensus-Ledger-SupportsMempool.html#t:GenTx" title="Ouroboros.Consensus.Ledger.SupportsMempool">GenTx</a> blk] &#8594; <a href="Ouroboros-Consensus-Protocol-Abstract.html#t:IsLeader" title="Ouroboros.Consensus.Protocol.Abstract">IsLeader</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:BlockProtocol" title="Ouroboros.Consensus.Block.Abstract">BlockProtocol</a> blk) &#8594; m blk</li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:MaintainForgeState">MaintainForgeState</a> (m &#8759; &#9733; &#8594; &#9733;) blk = <a href="#v:MaintainForgeState">MaintainForgeState</a> {<ul class="subs"><li><a href="#v:initForgeState">initForgeState</a> &#8759; <a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> blk</li><li><a href="#v:updateForgeState">updateForgeState</a> &#8759; <a href="Ouroboros-Consensus-Block-Forge.html#t:Update" title="Ouroboros.Consensus.Block.Forge">Update</a> m (<a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> blk) &#8594; <a href="Ouroboros-Consensus-Storage-ImmutableDB-Types.html#t:SlotNo" title="Ouroboros.Consensus.Storage.ImmutableDB.Types">SlotNo</a> &#8594; m ()</li></ul>}</li><li class="src short"><a href="#v:defaultMaintainForgeState">defaultMaintainForgeState</a> &#8759; (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m, <a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> blk ~ ()) &#8658; <a href="Ouroboros-Consensus-Block-Forge.html#t:MaintainForgeState" title="Ouroboros.Consensus.Block.Forge">MaintainForgeState</a> m blk</li><li class="src short"><a href="#v:castMaintainForgeState">castMaintainForgeState</a> &#8759; <a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> blk ~ <a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> blk' &#8658; <a href="Ouroboros-Consensus-Block-Forge.html#t:MaintainForgeState" title="Ouroboros.Consensus.Block.Forge">MaintainForgeState</a> m blk &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:MaintainForgeState" title="Ouroboros.Consensus.Block.Forge">MaintainForgeState</a> m blk'</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:Update">Update</a> m a = <a href="#v:Update">Update</a> {<ul class="subs"><li><a href="#v:runUpdate">runUpdate</a> &#8759; &#8704; b. (a &#8594; m (a, b)) &#8594; m b</li></ul>}</li><li class="src short"><a href="#v:runUpdate_">runUpdate_</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Functor.html#t:Functor" title="Data.Functor">Functor</a> m &#8658; <a href="Ouroboros-Consensus-Block-Forge.html#t:Update" title="Ouroboros.Consensus.Block.Forge">Update</a> m a &#8594; (a &#8594; m a) &#8594; m ()</li><li class="src short"><a href="#v:updateFromMVar">updateFromMVar</a> &#8759; (<a href="Ouroboros-Consensus-Util-MonadSTM-NormalForm.html#t:MonadSTM" title="Ouroboros.Consensus.Util.MonadSTM.NormalForm">MonadSTM</a> m, <a href="Ouroboros-Consensus-Util-IOLike.html#t:MonadCatch" title="Ouroboros.Consensus.Util.IOLike">MonadCatch</a> m) &#8658; <a href="Ouroboros-Consensus-Util-MonadSTM-StrictMVar.html#t:StrictMVar" title="Ouroboros.Consensus.Util.MonadSTM.StrictMVar">StrictMVar</a> m a &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:Update" title="Ouroboros.Consensus.Block.Forge">Update</a> m a</li><li class="src short"><a href="#v:liftUpdate">liftUpdate</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Functor.html#t:Functor" title="Data.Functor">Functor</a> m &#8658; (large &#8594; small) &#8594; (small &#8594; large &#8594; large) &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:Update" title="Ouroboros.Consensus.Block.Forge">Update</a> m large &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:Update" title="Ouroboros.Consensus.Block.Forge">Update</a> m small</li><li class="src short"><a href="#v:coerceUpdate">coerceUpdate</a> &#8759; (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Functor.html#t:Functor" title="Data.Functor">Functor</a> m, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Coerce.html#t:Coercible" title="Data.Coerce">Coercible</a> a b) &#8658; <a href="Ouroboros-Consensus-Block-Forge.html#t:Update" title="Ouroboros.Consensus.Block.Forge">Update</a> m a &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:Update" title="Ouroboros.Consensus.Block.Forge">Update</a> m b</li><li class="src short"><a href="#v:traceUpdate">traceUpdate</a> &#8759; &#8704; m a. <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m &#8658; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/Control-Tracer.html#t:Tracer" title="Control.Tracer">Tracer</a> m a &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:Update" title="Ouroboros.Consensus.Block.Forge">Update</a> m a &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:Update" title="Ouroboros.Consensus.Block.Forge">Update</a> m a</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">class</span> (<a href="Ouroboros-Consensus-Util-IOLike.html#t:NoUnexpectedThunks" title="Ouroboros.Consensus.Util.IOLike">NoUnexpectedThunks</a> (<a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> blk), <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> blk)) &#8658; <a id="t:CanForge" class="def">CanForge</a> blk <span class="keyword">where</span> <a href="src/Ouroboros.Consensus.Block.Forge.html#CanForge" class="link">Source</a> <a href="#t:CanForge" class="selflink">#</a></p><div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a id="t:ForgeState" class="def">ForgeState</a> blk &#8759; &#9733; <a href="src/Ouroboros.Consensus.Block.Forge.html#ForgeState" class="link">Source</a> <a href="#t:ForgeState" class="selflink">#</a></p><div class="doc"><p>(Chain-independent) state required to forge blocks</p></div></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:forgeBlock" class="def">forgeBlock</a> <a href="src/Ouroboros.Consensus.Block.Forge.html#forgeBlock" class="link">Source</a> <a href="#v:forgeBlock" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">&#8759; <a href="Ouroboros-Consensus-Util-Random.html#t:MonadRandom" title="Ouroboros.Consensus.Util.Random">MonadRandom</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8658; <a href="Ouroboros-Consensus-Config.html#t:TopLevelConfig" title="Ouroboros.Consensus.Config">TopLevelConfig</a> blk</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> blk</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8594; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/Cardano-Slotting-Block.html#t:BlockNo" title="Cardano.Slotting.Block">BlockNo</a></td><td class="doc"><p>Current block number</p></td></tr><tr><td class="src">&#8594; <a href="Ouroboros-Consensus-Ledger-Abstract.html#t:TickedLedgerState" title="Ouroboros.Consensus.Ledger.Abstract">TickedLedgerState</a> blk</td><td class="doc"><p>Current ledger</p></td></tr><tr><td class="src">&#8594; [<a href="Ouroboros-Consensus-Ledger-SupportsMempool.html#t:GenTx" title="Ouroboros.Consensus.Ledger.SupportsMempool">GenTx</a> blk]</td><td class="doc"><p>Txs to add in the block</p></td></tr><tr><td class="src">&#8594; <a href="Ouroboros-Consensus-Protocol-Abstract.html#t:IsLeader" title="Ouroboros.Consensus.Protocol.Abstract">IsLeader</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:BlockProtocol" title="Ouroboros.Consensus.Block.Abstract">BlockProtocol</a> blk)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8594; m blk</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Forge a new block</p><p>The forge state that is passed to <code><a href="Ouroboros-Consensus-Block-Forge.html#v:forgeBlock" title="Ouroboros.Consensus.Block.Forge">forgeBlock</a></code> will already have been
 updated.</p><p>TODO: This should be a pure function
 <a href="https://github.com/input-output-hk/ouroboros-network/issues/2058">https://github.com/input-output-hk/ouroboros-network/issues/2058</a></p></div></div><div class="subs instances"><details id="i:CanForge" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:CanForge:CanForge:1"></span> (<a href="Ouroboros-Consensus-HardFork-Combinator-Abstract-CanHardFork.html#t:CanHardFork" title="Ouroboros.Consensus.HardFork.Combinator.Abstract.CanHardFork">CanHardFork</a> xs, <a href="Data-SOP-Strict.html#t:All" title="Data.SOP.Strict">All</a> <a href="Ouroboros-Consensus-Block-Forge.html#t:CanForge" title="Ouroboros.Consensus.Block.Forge">CanForge</a> xs) &#8658; <a href="Ouroboros-Consensus-Block-Forge.html#t:CanForge" title="Ouroboros.Consensus.Block.Forge">CanForge</a> (<a href="Ouroboros-Consensus-HardFork-Combinator-Basics.html#t:HardForkBlock" title="Ouroboros.Consensus.HardFork.Combinator.Basics">HardForkBlock</a> xs)</span> <a href="src/Ouroboros.Consensus.HardFork.Combinator.Forge.html#line-31" class="link">Source</a> <a href="#t:CanForge" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:ic:CanForge:CanForge:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-HardFork-Combinator-Forge.html">Ouroboros.Consensus.HardFork.Combinator.Forge</a></p> <div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> (<a href="Ouroboros-Consensus-HardFork-Combinator-Basics.html#t:HardForkBlock" title="Ouroboros.Consensus.HardFork.Combinator.Basics">HardForkBlock</a> xs) &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <a href="src/Ouroboros.Consensus.Block.Forge.html#ForgeState" class="link">Source</a> <a href="#t:ForgeState" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:forgeBlock">forgeBlock</a> &#8759; <a href="Ouroboros-Consensus-Util-Random.html#t:MonadRandom" title="Ouroboros.Consensus.Util.Random">MonadRandom</a> m &#8658; <a href="Ouroboros-Consensus-Config.html#t:TopLevelConfig" title="Ouroboros.Consensus.Config">TopLevelConfig</a> (<a href="Ouroboros-Consensus-HardFork-Combinator-Basics.html#t:HardForkBlock" title="Ouroboros.Consensus.HardFork.Combinator.Basics">HardForkBlock</a> xs) &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> (<a href="Ouroboros-Consensus-HardFork-Combinator-Basics.html#t:HardForkBlock" title="Ouroboros.Consensus.HardFork.Combinator.Basics">HardForkBlock</a> xs) &#8594; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/Cardano-Slotting-Block.html#t:BlockNo" title="Cardano.Slotting.Block">BlockNo</a> &#8594; <a href="Ouroboros-Consensus-Ledger-Abstract.html#t:TickedLedgerState" title="Ouroboros.Consensus.Ledger.Abstract">TickedLedgerState</a> (<a href="Ouroboros-Consensus-HardFork-Combinator-Basics.html#t:HardForkBlock" title="Ouroboros.Consensus.HardFork.Combinator.Basics">HardForkBlock</a> xs) &#8594; [<a href="Ouroboros-Consensus-Ledger-SupportsMempool.html#t:GenTx" title="Ouroboros.Consensus.Ledger.SupportsMempool">GenTx</a> (<a href="Ouroboros-Consensus-HardFork-Combinator-Basics.html#t:HardForkBlock" title="Ouroboros.Consensus.HardFork.Combinator.Basics">HardForkBlock</a> xs)] &#8594; <a href="Ouroboros-Consensus-Protocol-Abstract.html#t:IsLeader" title="Ouroboros.Consensus.Protocol.Abstract">IsLeader</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:BlockProtocol" title="Ouroboros.Consensus.Block.Abstract">BlockProtocol</a> (<a href="Ouroboros-Consensus-HardFork-Combinator-Basics.html#t:HardForkBlock" title="Ouroboros.Consensus.HardFork.Combinator.Basics">HardForkBlock</a> xs)) &#8594; m (<a href="Ouroboros-Consensus-HardFork-Combinator-Basics.html#t:HardForkBlock" title="Ouroboros.Consensus.HardFork.Combinator.Basics">HardForkBlock</a> xs) <a href="src/Ouroboros.Consensus.Block.Forge.html#forgeBlock" class="link">Source</a> <a href="#v:forgeBlock" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:CanForge:CanForge:2"></span> <a href="Ouroboros-Consensus-HardFork-Combinator-Abstract-NoHardForks.html#t:NoHardForks" title="Ouroboros.Consensus.HardFork.Combinator.Abstract.NoHardForks">NoHardForks</a> b &#8658; <a href="Ouroboros-Consensus-Block-Forge.html#t:CanForge" title="Ouroboros.Consensus.Block.Forge">CanForge</a> (<a href="Ouroboros-Consensus-HardFork-Combinator-Degenerate.html#t:DegenFork" title="Ouroboros.Consensus.HardFork.Combinator.Degenerate">DegenFork</a> b)</span> <a href="src/Ouroboros.Consensus.HardFork.Combinator.Degenerate.html#line-252" class="link">Source</a> <a href="#t:CanForge" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:ic:CanForge:CanForge:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-HardFork-Combinator-Degenerate.html">Ouroboros.Consensus.HardFork.Combinator.Degenerate</a></p> <div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> (<a href="Ouroboros-Consensus-HardFork-Combinator-Degenerate.html#t:DegenFork" title="Ouroboros.Consensus.HardFork.Combinator.Degenerate">DegenFork</a> b) &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <a href="src/Ouroboros.Consensus.Block.Forge.html#ForgeState" class="link">Source</a> <a href="#t:ForgeState" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:forgeBlock">forgeBlock</a> &#8759; <a href="Ouroboros-Consensus-Util-Random.html#t:MonadRandom" title="Ouroboros.Consensus.Util.Random">MonadRandom</a> m &#8658; <a href="Ouroboros-Consensus-Config.html#t:TopLevelConfig" title="Ouroboros.Consensus.Config">TopLevelConfig</a> (<a href="Ouroboros-Consensus-HardFork-Combinator-Degenerate.html#t:DegenFork" title="Ouroboros.Consensus.HardFork.Combinator.Degenerate">DegenFork</a> b) &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> (<a href="Ouroboros-Consensus-HardFork-Combinator-Degenerate.html#t:DegenFork" title="Ouroboros.Consensus.HardFork.Combinator.Degenerate">DegenFork</a> b) &#8594; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/Cardano-Slotting-Block.html#t:BlockNo" title="Cardano.Slotting.Block">BlockNo</a> &#8594; <a href="Ouroboros-Consensus-Ledger-Abstract.html#t:TickedLedgerState" title="Ouroboros.Consensus.Ledger.Abstract">TickedLedgerState</a> (<a href="Ouroboros-Consensus-HardFork-Combinator-Degenerate.html#t:DegenFork" title="Ouroboros.Consensus.HardFork.Combinator.Degenerate">DegenFork</a> b) &#8594; [<a href="Ouroboros-Consensus-Ledger-SupportsMempool.html#t:GenTx" title="Ouroboros.Consensus.Ledger.SupportsMempool">GenTx</a> (<a href="Ouroboros-Consensus-HardFork-Combinator-Degenerate.html#t:DegenFork" title="Ouroboros.Consensus.HardFork.Combinator.Degenerate">DegenFork</a> b)] &#8594; <a href="Ouroboros-Consensus-Protocol-Abstract.html#t:IsLeader" title="Ouroboros.Consensus.Protocol.Abstract">IsLeader</a> (<a href="Ouroboros-Consensus-Block-Abstract.html#t:BlockProtocol" title="Ouroboros.Consensus.Block.Abstract">BlockProtocol</a> (<a href="Ouroboros-Consensus-HardFork-Combinator-Degenerate.html#t:DegenFork" title="Ouroboros.Consensus.HardFork.Combinator.Degenerate">DegenFork</a> b)) &#8594; m (<a href="Ouroboros-Consensus-HardFork-Combinator-Degenerate.html#t:DegenFork" title="Ouroboros.Consensus.HardFork.Combinator.Degenerate">DegenFork</a> b) <a href="src/Ouroboros.Consensus.Block.Forge.html#forgeBlock" class="link">Source</a> <a href="#v:forgeBlock" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><a href="#g:1" id="g:1"><h1>MaintainForgeState</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:MaintainForgeState" class="def">MaintainForgeState</a> (m &#8759; &#9733; &#8594; &#9733;) blk <a href="src/Ouroboros.Consensus.Block.Forge.html#MaintainForgeState" class="link">Source</a> <a href="#t:MaintainForgeState" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:MaintainForgeState" class="def">MaintainForgeState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:initForgeState" class="def">initForgeState</a> &#8759; <a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> blk</dfn><div class="doc"><p>Initial forge state</p></div></li><li><dfn class="src"><a id="v:updateForgeState" class="def">updateForgeState</a> &#8759; <a href="Ouroboros-Consensus-Block-Forge.html#t:Update" title="Ouroboros.Consensus.Block.Forge">Update</a> m (<a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> blk) &#8594; <a href="Ouroboros-Consensus-Storage-ImmutableDB-Types.html#t:SlotNo" title="Ouroboros.Consensus.Storage.ImmutableDB.Types">SlotNo</a> &#8594; m ()</dfn><div class="doc"><p>Update the forge state</p><p>This function is the reason that <code><a href="Ouroboros-Consensus-Block-Forge.html#t:MaintainForgeState" title="Ouroboros.Consensus.Block.Forge">MaintainForgeState</a></code> is a record:
 this function may have all kinds of things in its closure; for example,
 we might need access to some external hardware crypto hardware
 device.</p></div></li></ul></div></td></tr></table></div><div class="subs instances"><details id="i:MaintainForgeState" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:MaintainForgeState:Isomorphic:1"></span> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Functor.html#t:Functor" title="Data.Functor">Functor</a> m &#8658; <a href="Ouroboros-Consensus-HardFork-Combinator-Unary.html#t:Isomorphic" title="Ouroboros.Consensus.HardFork.Combinator.Unary">Isomorphic</a> (<a href="Ouroboros-Consensus-Block-Forge.html#t:MaintainForgeState" title="Ouroboros.Consensus.Block.Forge">MaintainForgeState</a> m)</span> <a href="src/Ouroboros.Consensus.HardFork.Combinator.Unary.html#line-335" class="link">Source</a> <a href="#t:Isomorphic" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:MaintainForgeState:Isomorphic:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-HardFork-Combinator-Unary.html">Ouroboros.Consensus.HardFork.Combinator.Unary</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:project">project</a> &#8759; <a href="Ouroboros-Consensus-HardFork-Combinator-Abstract-NoHardForks.html#t:NoHardForks" title="Ouroboros.Consensus.HardFork.Combinator.Abstract.NoHardForks">NoHardForks</a> blk &#8658; <a href="Ouroboros-Consensus-Block-Forge.html#t:MaintainForgeState" title="Ouroboros.Consensus.Block.Forge">MaintainForgeState</a> m (<a href="Ouroboros-Consensus-HardFork-Combinator-Basics.html#t:HardForkBlock" title="Ouroboros.Consensus.HardFork.Combinator.Basics">HardForkBlock</a> (blk ': [])) &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:MaintainForgeState" title="Ouroboros.Consensus.Block.Forge">MaintainForgeState</a> m blk <a href="src/Ouroboros.Consensus.HardFork.Combinator.Unary.html#project" class="link">Source</a> <a href="#v:project" class="selflink">#</a></p><p class="src"><a href="#v:inject">inject</a> &#8759; <a href="Ouroboros-Consensus-HardFork-Combinator-Abstract-NoHardForks.html#t:NoHardForks" title="Ouroboros.Consensus.HardFork.Combinator.Abstract.NoHardForks">NoHardForks</a> blk &#8658; <a href="Ouroboros-Consensus-Block-Forge.html#t:MaintainForgeState" title="Ouroboros.Consensus.Block.Forge">MaintainForgeState</a> m blk &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:MaintainForgeState" title="Ouroboros.Consensus.Block.Forge">MaintainForgeState</a> m (<a href="Ouroboros-Consensus-HardFork-Combinator-Basics.html#t:HardForkBlock" title="Ouroboros.Consensus.HardFork.Combinator.Basics">HardForkBlock</a> (blk ': [])) <a href="src/Ouroboros.Consensus.HardFork.Combinator.Unary.html#inject" class="link">Source</a> <a href="#v:inject" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:defaultMaintainForgeState" class="def">defaultMaintainForgeState</a> &#8759; (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m, <a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> blk ~ ()) &#8658; <a href="Ouroboros-Consensus-Block-Forge.html#t:MaintainForgeState" title="Ouroboros.Consensus.Block.Forge">MaintainForgeState</a> m blk <a href="src/Ouroboros.Consensus.Block.Forge.html#defaultMaintainForgeState" class="link">Source</a> <a href="#v:defaultMaintainForgeState" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:castMaintainForgeState" class="def">castMaintainForgeState</a> &#8759; <a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> blk ~ <a href="Ouroboros-Consensus-Block-Forge.html#t:ForgeState" title="Ouroboros.Consensus.Block.Forge">ForgeState</a> blk' &#8658; <a href="Ouroboros-Consensus-Block-Forge.html#t:MaintainForgeState" title="Ouroboros.Consensus.Block.Forge">MaintainForgeState</a> m blk &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:MaintainForgeState" title="Ouroboros.Consensus.Block.Forge">MaintainForgeState</a> m blk' <a href="src/Ouroboros.Consensus.Block.Forge.html#castMaintainForgeState" class="link">Source</a> <a href="#v:castMaintainForgeState" class="selflink">#</a></p></div><a href="#g:2" id="g:2"><h1>Infrastructure for dealing with state updates</h1></a><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:Update" class="def">Update</a> m a <a href="src/Ouroboros.Consensus.Block.Forge.html#Update" class="link">Source</a> <a href="#t:Update" class="selflink">#</a></p><div class="doc"><p>Update a stateful value</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Update" class="def">Update</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:runUpdate" class="def">runUpdate</a> &#8759; &#8704; b. (a &#8594; m (a, b)) &#8594; m b</dfn><div class="doc"><p>Update the value, and produce a result</p></div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:runUpdate_" class="def">runUpdate_</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Functor.html#t:Functor" title="Data.Functor">Functor</a> m &#8658; <a href="Ouroboros-Consensus-Block-Forge.html#t:Update" title="Ouroboros.Consensus.Block.Forge">Update</a> m a &#8594; (a &#8594; m a) &#8594; m () <a href="src/Ouroboros.Consensus.Block.Forge.html#runUpdate_" class="link">Source</a> <a href="#v:runUpdate_" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:updateFromMVar" class="def">updateFromMVar</a> &#8759; (<a href="Ouroboros-Consensus-Util-MonadSTM-NormalForm.html#t:MonadSTM" title="Ouroboros.Consensus.Util.MonadSTM.NormalForm">MonadSTM</a> m, <a href="Ouroboros-Consensus-Util-IOLike.html#t:MonadCatch" title="Ouroboros.Consensus.Util.IOLike">MonadCatch</a> m) &#8658; <a href="Ouroboros-Consensus-Util-MonadSTM-StrictMVar.html#t:StrictMVar" title="Ouroboros.Consensus.Util.MonadSTM.StrictMVar">StrictMVar</a> m a &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:Update" title="Ouroboros.Consensus.Block.Forge">Update</a> m a <a href="src/Ouroboros.Consensus.Block.Forge.html#updateFromMVar" class="link">Source</a> <a href="#v:updateFromMVar" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:liftUpdate" class="def">liftUpdate</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Functor.html#t:Functor" title="Data.Functor">Functor</a> m &#8658; (large &#8594; small) &#8594; (small &#8594; large &#8594; large) &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:Update" title="Ouroboros.Consensus.Block.Forge">Update</a> m large &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:Update" title="Ouroboros.Consensus.Block.Forge">Update</a> m small <a href="src/Ouroboros.Consensus.Block.Forge.html#liftUpdate" class="link">Source</a> <a href="#v:liftUpdate" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:coerceUpdate" class="def">coerceUpdate</a> &#8759; (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Functor.html#t:Functor" title="Data.Functor">Functor</a> m, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Coerce.html#t:Coercible" title="Data.Coerce">Coercible</a> a b) &#8658; <a href="Ouroboros-Consensus-Block-Forge.html#t:Update" title="Ouroboros.Consensus.Block.Forge">Update</a> m a &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:Update" title="Ouroboros.Consensus.Block.Forge">Update</a> m b <a href="src/Ouroboros.Consensus.Block.Forge.html#coerceUpdate" class="link">Source</a> <a href="#v:coerceUpdate" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:traceUpdate" class="def">traceUpdate</a> &#8759; &#8704; m a. <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m &#8658; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/Control-Tracer.html#t:Tracer" title="Control.Tracer">Tracer</a> m a &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:Update" title="Ouroboros.Consensus.Block.Forge">Update</a> m a &#8594; <a href="Ouroboros-Consensus-Block-Forge.html#t:Update" title="Ouroboros.Consensus.Block.Forge">Update</a> m a <a href="src/Ouroboros.Consensus.Block.Forge.html#traceUpdate" class="link">Source</a> <a href="#v:traceUpdate" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>