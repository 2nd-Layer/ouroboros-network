<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ouroboros.Consensus.Storage.LedgerDB.InMemory</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html">Source</a></li><li><a href="&quot;../index.html&quot;">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ouroboros-consensus-0.1.0.0: Consensus layer for the Ouroboros blockchain protocol</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Ouroboros.Consensus.Storage.LedgerDB.InMemory</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">LedgerDB proper</a><ul><li><a href="#g:2">ChainSummary</a></li><li><a href="#g:3">Queries</a></li><li><a href="#g:4">Result types</a></li><li><a href="#g:5">Past ledger states</a></li><li><a href="#g:6">Updates</a></li></ul></li><li><a href="#g:7">Exports for the benefit of tests</a><ul><li><a href="#g:8">Additional queries</a></li><li><a href="#g:9">Pure API</a></li><li><a href="#g:10">Simplifying the result types</a></li></ul></li></ul></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:LedgerDB">LedgerDB</a> l r</li><li class="src short"><span class="keyword">data</span> <a href="#t:LedgerDbParams">LedgerDbParams</a> = <a href="#v:LedgerDbParams">LedgerDbParams</a> {<ul class="subs"><li><a href="#v:ledgerDbSnapEvery">ledgerDbSnapEvery</a> &#8759; !<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a></li><li><a href="#v:ledgerDbSecurityParam">ledgerDbSecurityParam</a> &#8759; !<a href="Ouroboros-Consensus-Protocol-Abstract.html#t:SecurityParam" title="Ouroboros.Consensus.Protocol.Abstract">SecurityParam</a></li></ul>}</li><li class="src short"><a href="#v:ledgerDbDefaultParams">ledgerDbDefaultParams</a> &#8759; <a href="Ouroboros-Consensus-Protocol-Abstract.html#t:SecurityParam" title="Ouroboros.Consensus.Protocol.Abstract">SecurityParam</a> &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a></li><li class="src short"><a href="#v:ledgerDbWithAnchor">ledgerDbWithAnchor</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r</li><li class="src short"><a href="#v:ledgerDbFromGenesis">ledgerDbFromGenesis</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> &#8594; l &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r</li><li class="src short"><span class="keyword">data</span> <a href="#t:ChainSummary">ChainSummary</a> l r = <a href="#v:ChainSummary">ChainSummary</a> {<ul class="subs"><li><a href="#v:csTip">csTip</a> &#8759; !(<a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/Cardano-Slotting-Slot.html#t:WithOrigin" title="Cardano.Slotting.Slot">WithOrigin</a> r)</li><li><a href="#v:csLength">csLength</a> &#8759; !<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a></li><li><a href="#v:csLedger">csLedger</a> &#8759; !l</li></ul>}</li><li class="src short"><a href="#v:encodeChainSummary">encodeChainSummary</a> &#8759; (l &#8594; Encoding) &#8594; (r &#8594; Encoding) &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r &#8594; Encoding</li><li class="src short"><a href="#v:decodeChainSummary">decodeChainSummary</a> &#8759; (&#8704; s. Decoder s l) &#8594; (&#8704; s. Decoder s r) &#8594; &#8704; s. Decoder s (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r)</li><li class="src short"><a href="#v:ledgerDbCurrent">ledgerDbCurrent</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; l</li><li class="src short"><a href="#v:ledgerDbTip">ledgerDbTip</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/Cardano-Slotting-Slot.html#t:WithOrigin" title="Cardano.Slotting.Slot">WithOrigin</a> r</li><li class="src short"><a href="#v:ledgerDbAnchor">ledgerDbAnchor</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r</li><li class="src short"><span class="keyword">data</span> <a href="#t:PushManyResult">PushManyResult</a> e l r &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> &#8594; &#9733; <span class="keyword">where</span><ul class="subs"><li><a href="#v:InvalidBlock">InvalidBlock</a> &#8759; e &#8594; r &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:PushManyResult" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">PushManyResult</a> e l r <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#v:False" title="Data.Bool">False</a></li><li><a href="#v:ValidBlocks">ValidBlocks</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:PushManyResult" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">PushManyResult</a> e l r ap</li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:SwitchResult">SwitchResult</a> e l r &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> &#8594; &#9733; <span class="keyword">where</span><ul class="subs"><li><a href="#v:MaximumRollbackExceeded">MaximumRollbackExceeded</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a> &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:SwitchResult" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">SwitchResult</a> e l r ap</li><li><a href="#v:RollbackSuccessful">RollbackSuccessful</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:PushManyResult" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">PushManyResult</a> e l r ap &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:SwitchResult" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">SwitchResult</a> e l r ap</li></ul></li><li class="src short"><a href="#v:ledgerDbPast">ledgerDbPast</a> &#8759; &#8704; m l r b e. (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> r) &#8658; <a href="Ouroboros-Consensus-Storage-LedgerDB-Conf.html#t:LedgerDbConf" title="Ouroboros.Consensus.Storage.LedgerDB.Conf">LedgerDbConf</a> m l r b e &#8594; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/Cardano-Slotting-Slot.html#t:WithOrigin" title="Cardano.Slotting.Slot">WithOrigin</a> r &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; m (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> l)</li><li class="src short"><span class="keyword">data</span> <a href="#t:Apply">Apply</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> &#8594; &#9733; <span class="keyword">where</span><ul class="subs"><li><a href="#v:Reapply">Reapply</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:Apply" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">Apply</a> pa</li><li><a href="#v:Apply">Apply</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:Apply" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">Apply</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#v:False" title="Data.Bool">False</a></li></ul></li><li class="src short"><span class="keyword">type family</span> <a href="#t:Err">Err</a> (ap &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>) (e &#8759; &#9733;) &#8759; &#9733; <span class="keyword">where ...</span></li><li class="src short"><span class="keyword">data</span> <a href="#t:RefOrVal">RefOrVal</a> r b<ul class="subs"><li>= <a href="#v:Ref">Ref</a> r</li><li>| <a href="#v:Val">Val</a> r b</li></ul></li><li class="src short"><a href="#v:ledgerDbPush">ledgerDbPush</a> &#8759; &#8704; m l r b e ap. <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m &#8658; <a href="Ouroboros-Consensus-Storage-LedgerDB-Conf.html#t:LedgerDbConf" title="Ouroboros.Consensus.Storage.LedgerDB.Conf">LedgerDbConf</a> m l r b e &#8594; (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:Apply" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">Apply</a> ap, <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:RefOrVal" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">RefOrVal</a> r b) &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; m (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Either.html#t:Either" title="Data.Either">Either</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:Err" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">Err</a> ap e) (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r))</li><li class="src short"><a href="#v:ledgerDbReapply">ledgerDbReapply</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m &#8658; <a href="Ouroboros-Consensus-Storage-LedgerDB-Conf.html#t:LedgerDbConf" title="Ouroboros.Consensus.Storage.LedgerDB.Conf">LedgerDbConf</a> m l r b e &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:RefOrVal" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">RefOrVal</a> r b &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; m (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r)</li><li class="src short"><a href="#v:ledgerDbSwitch">ledgerDbSwitch</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m &#8658; <a href="Ouroboros-Consensus-Storage-LedgerDB-Conf.html#t:LedgerDbConf" title="Ouroboros.Consensus.Storage.LedgerDB.Conf">LedgerDbConf</a> m l r b e &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a> &#8594; [(<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:Apply" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">Apply</a> ap, <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:RefOrVal" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">RefOrVal</a> r b)] &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; m (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:SwitchResult" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">SwitchResult</a> e l r ap)</li><li class="src short"><a href="#v:ledgerDbChainLength">ledgerDbChainLength</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a></li><li class="src short"><a href="#v:ledgerDbToList">ledgerDbToList</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; [(r, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> l)]</li><li class="src short"><a href="#v:ledgerDbMaxRollback">ledgerDbMaxRollback</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a></li><li class="src short"><a href="#v:ledgerDbSnapshots">ledgerDbSnapshots</a> &#8759; &#8704; l r. <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; [(<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a>, l)]</li><li class="src short"><a href="#v:ledgerDbIsSaturated">ledgerDbIsSaturated</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li class="src short"><a href="#v:ledgerDbCountToPrune">ledgerDbCountToPrune</a> &#8759; <a href="Ouroboros-Consensus-Util-CallStack.html#t:HasCallStack" title="Ouroboros.Consensus.Util.CallStack">HasCallStack</a> &#8658; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:ledgerDbPush-39-">ledgerDbPush'</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-Conf.html#t:PureLedgerDbConf" title="Ouroboros.Consensus.Storage.LedgerDB.Conf">PureLedgerDbConf</a> l b &#8594; b &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l b &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l b</li><li class="src short"><a href="#v:ledgerDbPushMany-39-">ledgerDbPushMany'</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-Conf.html#t:PureLedgerDbConf" title="Ouroboros.Consensus.Storage.LedgerDB.Conf">PureLedgerDbConf</a> l b &#8594; [b] &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l b &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l b</li><li class="src short"><a href="#v:ledgerDbSwitch-39-">ledgerDbSwitch'</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-Conf.html#t:PureLedgerDbConf" title="Ouroboros.Consensus.Storage.LedgerDB.Conf">PureLedgerDbConf</a> l b &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a> &#8594; [b] &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l b &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l b)</li><li class="src short"><a href="#v:ledgerDbPast-39-">ledgerDbPast'</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> b &#8658; <a href="Ouroboros-Consensus-Storage-LedgerDB-Conf.html#t:PureLedgerDbConf" title="Ouroboros.Consensus.Storage.LedgerDB.Conf">PureLedgerDbConf</a> l b &#8594; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/Cardano-Slotting-Slot.html#t:WithOrigin" title="Cardano.Slotting.Slot">WithOrigin</a> b &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l b &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> l</li><li class="src short"><a href="#v:pushManyResultToEither">pushManyResultToEither</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:PushManyResult" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">PushManyResult</a> e l r ap &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Either.html#t:Either" title="Data.Either">Either</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:Err" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">Err</a> ap e) (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r)</li><li class="src short"><a href="#v:switchResultToEither">switchResultToEither</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:SwitchResult" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">SwitchResult</a> e l r ap &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Either.html#t:Either" title="Data.Either">Either</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:Err" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">Err</a> ap e)) (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r)</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>LedgerDB proper</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:LedgerDB" class="def">LedgerDB</a> l r <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#LedgerDB" class="link">Source</a> <a href="#t:LedgerDB" class="selflink">#</a></p><div class="doc"><p>Internal state of the ledger DB</p><p>The ledger DB looks like</p><pre>anchor |&gt; blocks and snapshots &lt;| current</pre><p>where <code>anchor</code> records the oldest known snapshot and <code>current</code> the most
 recent.</p><p>As an example, suppose we have <code>snapEvery = 4</code> (i.e., we will take a
 snapshot every 4 blocks) and <code>k = 6</code>. The ledger DB grows as illustrated
 below, where we indicate the anchor, number of blocks, the stored
 blocks/snapshots, and the current ledger; the oldest block we can roll back
 to is marked.</p><pre>anchor |&gt; #   [ blocks ]                                      &lt;| tip
---------------------------------------------------------------------------
*G     |&gt; (0) [ ]                                             &lt;| G
*G     |&gt; (1) [ B1]                                           &lt;| L1
*G     |&gt; (2) [ B1,  B2]                                      &lt;| L2
*G     |&gt; (3) [ B1,  B2,   B3]                                &lt;| L3
*G     |&gt; (4) [ B1,  B2,   B3,  L4]                           &lt;| L4
*G     |&gt; (5) [ B1,  B2,   B3,  L4,  B5]                      &lt;| L5
*G     |&gt; (6) [ B1,  B2,   B3,  L4,  B5,  B6]                 &lt;| L6
 G     |&gt; (7) [*B1,  B2,   B3,  L4,  B5,  B6,  B7]            &lt;| L7
 G     |&gt; (8) [ B1, *B2,   B3,  L4,  B5,  B6,  B7,  L8]       &lt;| L8
 G     |&gt; (9) [ B1,  B2,  *B3,  L4,  B5,  B6,  B7,  L8,  B9]  &lt;| L9   (*)
*L4    |&gt; (6) [ B5,  B6,   B7,  L8,  B9,  B10]                &lt;| L10  (**)
 L4    |&gt; (7) [*B5,  B6,   B7,  L8,  B9,  B10, B11]           &lt;| L11
 L4    |&gt; (8) [ B5, *B6,   B7,  L8,  B9,  B10, B11, L12]      &lt;| L12
 L4    |&gt; (9) [ B5,  B6,  *B7,  L8,  B9,  B10, B12, L12, B13] &lt;| L13
*L8    |&gt; (6) [ B9,  B10,  B12, L12, B13, B14]                &lt;| L14</pre><p>The ledger DB must guarantee we must at all times be able to roll back <code>k</code>
 blocks. For example, if we are on line (*), and roll back 6 blocks, we get</p><pre>G |&gt; [B1, B2, B3]</pre><p>from which we can <em>compute</em> <code>G |&gt; [B1, B2, B3] &lt;| L3</code> by re-applying
 <code>snapEvery - 1</code> blocks. However, as soon as we pushed one more block <code>(**)</code>,
 and then roll back 6 blocks, we end up with</p><pre>L4 |&gt; [] &lt;| L4</pre><p>This representation has the following properties:</p><ul><li>The distance between snapshots is at most <code>snapEvery</code>. This implies that
   rolling back involves re-applying at most <code>snapEvery - 1</code> blocks
   (note that <code>snapEvery &gt;= 1</code>).</li><li>This implies that the number of (references to) blocks we store will vary
   between <code>k</code> and <code>k + snapEvery - 1</code> (unless we are near genesis).</li><li>When the number of blocks reaches <code>k + snapEvery</code>, we can drop the first
   <code>snapEvery</code> blocks, shifting up the anchor.</li><li>The average number of blocks we have to reapply on a rollback is given by</li></ul><pre>   average [0 .. snapEvery - 1]
== ((snapEvery - 1) * snapEvery / 2) / snapEvery
== (snapEvery - 1) / 2</pre><p>(Obvious) boundary case: if <code>snapEvery == 1</code>, the average number is zero.</p><ul><li>The number of snapshots we store is in the range</li></ul><pre>[1 + floor(k / snapEvery), 1 + ceiling(k / snapEvery)]</pre><p>If <code>snapEvery</code> divides <code>k</code>, the number is precisely <code>1 + k / snapEvery</code>.</p><ul><li>Picking a suitable value of <code>snapEvery</code> for a given <code>k</code> is a tradeoff
   between cost of reapplying blocks and the cost of storing more snapshots.
   The latter is primarily the cost of less opportunity for garbage
   collection, which is hard to quantify abstractly. This should probably
   be determined empirically.</li></ul><p>Some example boundary cases:</p><ul><li>Suppose <code>k = 4</code> and <code>snapEvery = 1</code>:</li></ul><pre>*G  |&gt; []               &lt;| G
*G  |&gt; [L1]             &lt;| L1
*G  |&gt; [L1, L2]         &lt;| L2
*G  |&gt; [L1, L2, L3]     &lt;| L3
*G  |&gt; [L1, L2, L3, L4] &lt;| L4
*L1 |&gt; [L2, L3, L4, L5] &lt;| L5
*L2 |&gt; [L3, L4, L5, L6] &lt;| L6</pre><p>Note that in this case the number of blocks will always be <code>k</code> (unless we
   are close to genesis), and the anchor is always the oldest point we can
   roll back to.</p><ul><li>If <code>k = 1</code> and <code>snapEvery = 4</code>, we get</li></ul><pre>*G  |&gt; [ ]                  &lt;| G
*G  |&gt; [ B1]                &lt;| L1
 G  |&gt; [*B1,  B2]           &lt;| L2
 G  |&gt; [ B1, *B2,  B3]      &lt;| L3
 G  |&gt; [ B1,  B2, *B3, L4]  &lt;| L4
*L4 |&gt; [ B5]                &lt;| L5
 L4 |&gt; [*B5,  B6]           &lt;| L6
 L4 |&gt; [ B5, *B6,  B7]      &lt;| L7
 L4 |&gt; [ B5,  B6, *B7, L8]  &lt;| L8
*L8 |&gt; [*B9]                &lt;| L9</pre><p>(The minimum distance between the current ledger and the maximum rollback
   is <code>k</code>.)</p><ul><li>If <code>k = 0</code> and <code>snapEvery = 4</code>, we get</li></ul><pre>*G  |&gt; [ ]                  &lt;| G
 G  |&gt; [*B1]                &lt;| L1
 G  |&gt; [ B1, *B2]           &lt;| L2
 G  |&gt; [ B1,  B2, *B3]      &lt;| L3
*L4 |&gt; [ ]                  &lt;| L4
 L4 |&gt; [*B5]                &lt;| L5
 L4 |&gt; [ B5, *B6]           &lt;| L6
 L4 |&gt; [ B5,  B6, *B7]      &lt;| L7
*L8 |&gt; [ ]                  &lt;| L8</pre><p><code>k = 0</code> is the only case where the list might be empty. Of course, this is
   not a particularly useful configuration.</p><ul><li>If <code>k = 1</code> and <code>snapEvery = 1</code>, we get</li></ul><pre>*G  |&gt; [ ]   &lt;| G
*G  |&gt; [ L1] &lt;| L1
*L1 |&gt; [ L2] &lt;| L2
*L2 |&gt; [ L3] &lt;| L3</pre><ul><li>If <code>k = 0</code> and <code>snapEvery = 1</code>, we get</li></ul><pre>*G  |&gt; [ ] &lt;| G
*L1 |&gt; [ ] &lt;| L1
*L2 |&gt; [ ] &lt;| L2</pre><ul><li>Finally, if <code>k = snapEvery = k4</code>, we get</li></ul><pre>*G  |&gt; [ ]                             &lt;| G
*G  |&gt; [ B1]                           &lt;| L1
*G  |&gt; [ B1,  B2]                      &lt;| L2
*G  |&gt; [ B1,  B2,  B3]                 &lt;| L3
*G  |&gt; [ B1,  B2,  B3, L4]             &lt;| L4
 G  |&gt; [*B1,  B2,  B3, L4, B5]         &lt;| L5
 G  |&gt; [ B1, *B2,  B3, L4, B5, B6]     &lt;| L6
 G  |&gt; [ B1,  B2, *B3, L4, B5, B6, B7] &lt;| L7
*L4 |&gt; [ B5,  B6,  B7, L8]             &lt;| L8
 L4 |&gt; [*B5,  B6,  B7, L8, B9]         &lt;| L9</pre></div><div class="subs instances"><details id="i:LedgerDB" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LedgerDB:Eq:1"></span> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> l, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> r) &#8658; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r)</span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#line-253" class="link">Source</a> <a href="#t:LedgerDB" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LedgerDB:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html">Ouroboros.Consensus.Storage.LedgerDB.InMemory</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LedgerDB:Show:2"></span> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> l, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> r) &#8658; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r)</span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#line-253" class="link">Source</a> <a href="#t:LedgerDB" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LedgerDB:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html">Ouroboros.Consensus.Storage.LedgerDB.InMemory</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> &#8759; [<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r] &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LedgerDB:Generic:3"></span> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Generic" title="GHC.Generics">Generic</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r)</span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#line-253" class="link">Source</a> <a href="#t:LedgerDB" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LedgerDB:Generic:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html">Ouroboros.Consensus.Storage.LedgerDB.InMemory</a></p> <div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r) &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <a href="#t:Rep" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:from">from</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r) x <a href="#v:from" class="selflink">#</a></p><p class="src"><a href="#v:to">to</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r) x &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r <a href="#v:to" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LedgerDB:NoUnexpectedThunks:4"></span> (<a href="Ouroboros-Consensus-Util-IOLike.html#t:NoUnexpectedThunks" title="Ouroboros.Consensus.Util.IOLike">NoUnexpectedThunks</a> l, <a href="Ouroboros-Consensus-Util-IOLike.html#t:NoUnexpectedThunks" title="Ouroboros.Consensus.Util.IOLike">NoUnexpectedThunks</a> r) &#8658; <a href="Ouroboros-Consensus-Util-IOLike.html#t:NoUnexpectedThunks" title="Ouroboros.Consensus.Util.IOLike">NoUnexpectedThunks</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r)</span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#line-253" class="link">Source</a> <a href="#t:LedgerDB" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LedgerDB:NoUnexpectedThunks:4"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html">Ouroboros.Consensus.Storage.LedgerDB.InMemory</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:noUnexpectedThunks">noUnexpectedThunks</a> &#8759; [<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a>] &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/Cardano-Prelude-GHC-Heap-NormalForm-Classy.html#t:ThunkInfo" title="Cardano.Prelude.GHC.Heap.NormalForm.Classy">ThunkInfo</a> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src" class="link">Source</a> <a href="#v:noUnexpectedThunks" class="selflink">#</a></p><p class="src"><a href="#v:whnfNoUnexpectedThunks">whnfNoUnexpectedThunks</a> &#8759; [<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a>] &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/Cardano-Prelude-GHC-Heap-NormalForm-Classy.html#t:ThunkInfo" title="Cardano.Prelude.GHC.Heap.NormalForm.Classy">ThunkInfo</a> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src" class="link">Source</a> <a href="#v:whnfNoUnexpectedThunks" class="selflink">#</a></p><p class="src"><a href="#v:showTypeOf">showTypeOf</a> &#8759; <a href="Ouroboros-Consensus-Util-RedundantConstraints.html#t:Proxy" title="Ouroboros.Consensus.Util.RedundantConstraints">Proxy</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r) &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src" class="link">Source</a> <a href="#v:showTypeOf" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LedgerDB:Rep:5"></span> <span class="keyword">type</span> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r)</span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#line-253" class="link">Source</a> <a href="#t:LedgerDB" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LedgerDB:Rep:5"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html">Ouroboros.Consensus.Storage.LedgerDB.InMemory</a></p> <div class="src"><span class="keyword">type</span> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r)</div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:LedgerDbParams" class="def">LedgerDbParams</a> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#LedgerDbParams" class="link">Source</a> <a href="#t:LedgerDbParams" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:LedgerDbParams" class="def">LedgerDbParams</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:ledgerDbSnapEvery" class="def">ledgerDbSnapEvery</a> &#8759; !<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a></dfn><div class="doc"><p>Take a snapshot every <code>n</code> blocks</p><p>Must be <code>&gt;= 1</code>.</p></div></li><li><dfn class="src"><a id="v:ledgerDbSecurityParam" class="def">ledgerDbSecurityParam</a> &#8759; !<a href="Ouroboros-Consensus-Protocol-Abstract.html#t:SecurityParam" title="Ouroboros.Consensus.Protocol.Abstract">SecurityParam</a></dfn><div class="doc"><p>Security parameter (maximum rollback)</p></div></li></ul></div></td></tr></table></div><div class="subs instances"><details id="i:LedgerDbParams" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LedgerDbParams:Eq:1"></span> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a></span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#line-264" class="link">Source</a> <a href="#t:LedgerDbParams" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LedgerDbParams:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html">Ouroboros.Consensus.Storage.LedgerDB.InMemory</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LedgerDbParams:Show:2"></span> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a></span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#line-264" class="link">Source</a> <a href="#t:LedgerDbParams" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LedgerDbParams:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html">Ouroboros.Consensus.Storage.LedgerDB.InMemory</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> &#8759; [<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a>] &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LedgerDbParams:Generic:3"></span> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Generic" title="GHC.Generics">Generic</a> <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a></span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#line-264" class="link">Source</a> <a href="#t:LedgerDbParams" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LedgerDbParams:Generic:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html">Ouroboros.Consensus.Storage.LedgerDB.InMemory</a></p> <div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <a href="#t:Rep" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:from">from</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> x <a href="#v:from" class="selflink">#</a></p><p class="src"><a href="#v:to">to</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> x &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> <a href="#v:to" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LedgerDbParams:NoUnexpectedThunks:4"></span> <a href="Ouroboros-Consensus-Util-IOLike.html#t:NoUnexpectedThunks" title="Ouroboros.Consensus.Util.IOLike">NoUnexpectedThunks</a> <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a></span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#line-264" class="link">Source</a> <a href="#t:LedgerDbParams" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LedgerDbParams:NoUnexpectedThunks:4"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html">Ouroboros.Consensus.Storage.LedgerDB.InMemory</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:noUnexpectedThunks">noUnexpectedThunks</a> &#8759; [<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a>] &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/Cardano-Prelude-GHC-Heap-NormalForm-Classy.html#t:ThunkInfo" title="Cardano.Prelude.GHC.Heap.NormalForm.Classy">ThunkInfo</a> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src" class="link">Source</a> <a href="#v:noUnexpectedThunks" class="selflink">#</a></p><p class="src"><a href="#v:whnfNoUnexpectedThunks">whnfNoUnexpectedThunks</a> &#8759; [<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a>] &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/Cardano-Prelude-GHC-Heap-NormalForm-Classy.html#t:ThunkInfo" title="Cardano.Prelude.GHC.Heap.NormalForm.Classy">ThunkInfo</a> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src" class="link">Source</a> <a href="#v:whnfNoUnexpectedThunks" class="selflink">#</a></p><p class="src"><a href="#v:showTypeOf">showTypeOf</a> &#8759; <a href="Ouroboros-Consensus-Util-RedundantConstraints.html#t:Proxy" title="Ouroboros.Consensus.Util.RedundantConstraints">Proxy</a> <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src" class="link">Source</a> <a href="#v:showTypeOf" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:LedgerDbParams:Rep:5"></span> <span class="keyword">type</span> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a></span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#line-264" class="link">Source</a> <a href="#t:LedgerDbParams" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:LedgerDbParams:Rep:5"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html">Ouroboros.Consensus.Storage.LedgerDB.InMemory</a></p> <div class="src"><span class="keyword">type</span> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> = <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:D1" title="GHC.Generics">D1</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:MetaData" title="GHC.Generics">MetaData</a> &quot;LedgerDbParams&quot; &quot;Ouroboros.Consensus.Storage.LedgerDB.InMemory&quot; &quot;ouroboros-consensus-0.1.0.0-inplace&quot; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#v:False" title="Data.Bool">False</a>) (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:C1" title="GHC.Generics">C1</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:MetaCons" title="GHC.Generics">MetaCons</a> &quot;LedgerDbParams&quot; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:PrefixI" title="GHC.Generics">PrefixI</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#v:True" title="Data.Bool">True</a>) (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:S1" title="GHC.Generics">S1</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:MetaSel" title="GHC.Generics">MetaSel</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#v:Just" title="GHC.Maybe">Just</a> &quot;ledgerDbSnapEvery&quot;) <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:NoSourceUnpackedness" title="GHC.Generics">NoSourceUnpackedness</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:SourceStrict" title="GHC.Generics">SourceStrict</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:DecidedStrict" title="GHC.Generics">DecidedStrict</a>) (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rec0" title="GHC.Generics">Rec0</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a>) <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t::-42-:" title="GHC.Generics">:*:</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:S1" title="GHC.Generics">S1</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:MetaSel" title="GHC.Generics">MetaSel</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#v:Just" title="GHC.Maybe">Just</a> &quot;ledgerDbSecurityParam&quot;) <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:NoSourceUnpackedness" title="GHC.Generics">NoSourceUnpackedness</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:SourceStrict" title="GHC.Generics">SourceStrict</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:DecidedStrict" title="GHC.Generics">DecidedStrict</a>) (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rec0" title="GHC.Generics">Rec0</a> <a href="Ouroboros-Consensus-Protocol-Abstract.html#t:SecurityParam" title="Ouroboros.Consensus.Protocol.Abstract">SecurityParam</a>)))</div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:ledgerDbDefaultParams" class="def">ledgerDbDefaultParams</a> &#8759; <a href="Ouroboros-Consensus-Protocol-Abstract.html#t:SecurityParam" title="Ouroboros.Consensus.Protocol.Abstract">SecurityParam</a> &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbDefaultParams" class="link">Source</a> <a href="#v:ledgerDbDefaultParams" class="selflink">#</a></p><div class="doc"><p>Default parameters</p><p>TODO: We should decide empirically what a good <code>snapEvery</code> value is.
 <a href="https://github.com/input-output-hk/ouroboros-network/issues/1026">https://github.com/input-output-hk/ouroboros-network/issues/1026</a></p></div></div><div class="top"><p class="src"><a id="v:ledgerDbWithAnchor" class="def">ledgerDbWithAnchor</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbWithAnchor" class="link">Source</a> <a href="#v:ledgerDbWithAnchor" class="selflink">#</a></p><div class="doc"><p>Ledger DB starting at the specified ledger state</p></div></div><div class="top"><p class="src"><a id="v:ledgerDbFromGenesis" class="def">ledgerDbFromGenesis</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> &#8594; l &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbFromGenesis" class="link">Source</a> <a href="#v:ledgerDbFromGenesis" class="selflink">#</a></p></div><a href="#g:2" id="g:2"><h2>ChainSummary</h2></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:ChainSummary" class="def">ChainSummary</a> l r <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ChainSummary" class="link">Source</a> <a href="#t:ChainSummary" class="selflink">#</a></p><div class="doc"><p>Summary of the chain at a particular point in time</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:ChainSummary" class="def">ChainSummary</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:csTip" class="def">csTip</a> &#8759; !(<a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/Cardano-Slotting-Slot.html#t:WithOrigin" title="Cardano.Slotting.Slot">WithOrigin</a> r)</dfn><div class="doc"><p>The tip of the chain</p></div></li><li><dfn class="src"><a id="v:csLength" class="def">csLength</a> &#8759; !<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a></dfn><div class="doc"><p>Length of the chain</p></div></li><li><dfn class="src"><a id="v:csLedger" class="def">csLedger</a> &#8759; !l</dfn><div class="doc"><p>Ledger state</p></div></li></ul></div></td></tr></table></div><div class="subs instances"><details id="i:ChainSummary" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ChainSummary:Eq:1"></span> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> r, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> l) &#8658; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r)</span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#line-355" class="link">Source</a> <a href="#t:ChainSummary" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ChainSummary:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html">Ouroboros.Consensus.Storage.LedgerDB.InMemory</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ChainSummary:Show:2"></span> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> r, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> l) &#8658; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r)</span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#line-355" class="link">Source</a> <a href="#t:ChainSummary" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ChainSummary:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html">Ouroboros.Consensus.Storage.LedgerDB.InMemory</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> &#8759; [<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r] &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ChainSummary:Generic:3"></span> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Generic" title="GHC.Generics">Generic</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r)</span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#line-355" class="link">Source</a> <a href="#t:ChainSummary" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ChainSummary:Generic:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html">Ouroboros.Consensus.Storage.LedgerDB.InMemory</a></p> <div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r) &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <a href="#t:Rep" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:from">from</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r) x <a href="#v:from" class="selflink">#</a></p><p class="src"><a href="#v:to">to</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r) x &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r <a href="#v:to" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ChainSummary:NoUnexpectedThunks:4"></span> (<a href="Ouroboros-Consensus-Util-IOLike.html#t:NoUnexpectedThunks" title="Ouroboros.Consensus.Util.IOLike">NoUnexpectedThunks</a> r, <a href="Ouroboros-Consensus-Util-IOLike.html#t:NoUnexpectedThunks" title="Ouroboros.Consensus.Util.IOLike">NoUnexpectedThunks</a> l) &#8658; <a href="Ouroboros-Consensus-Util-IOLike.html#t:NoUnexpectedThunks" title="Ouroboros.Consensus.Util.IOLike">NoUnexpectedThunks</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r)</span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#line-355" class="link">Source</a> <a href="#t:ChainSummary" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ChainSummary:NoUnexpectedThunks:4"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html">Ouroboros.Consensus.Storage.LedgerDB.InMemory</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:noUnexpectedThunks">noUnexpectedThunks</a> &#8759; [<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a>] &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/Cardano-Prelude-GHC-Heap-NormalForm-Classy.html#t:ThunkInfo" title="Cardano.Prelude.GHC.Heap.NormalForm.Classy">ThunkInfo</a> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src" class="link">Source</a> <a href="#v:noUnexpectedThunks" class="selflink">#</a></p><p class="src"><a href="#v:whnfNoUnexpectedThunks">whnfNoUnexpectedThunks</a> &#8759; [<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a>] &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/Cardano-Prelude-GHC-Heap-NormalForm-Classy.html#t:ThunkInfo" title="Cardano.Prelude.GHC.Heap.NormalForm.Classy">ThunkInfo</a> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src" class="link">Source</a> <a href="#v:whnfNoUnexpectedThunks" class="selflink">#</a></p><p class="src"><a href="#v:showTypeOf">showTypeOf</a> &#8759; <a href="Ouroboros-Consensus-Util-RedundantConstraints.html#t:Proxy" title="Ouroboros.Consensus.Util.RedundantConstraints">Proxy</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r) &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src" class="link">Source</a> <a href="#v:showTypeOf" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ChainSummary:Serialise:5"></span> (Serialise l, Serialise r) &#8658; Serialise (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r)</span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#line-801" class="link">Source</a> <a href="#t:ChainSummary" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ChainSummary:Serialise:5"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html">Ouroboros.Consensus.Storage.LedgerDB.InMemory</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:encode">encode</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r &#8594; Encoding</p><p class="src"><a href="#v:decode">decode</a> &#8759; Decoder s (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r)</p><p class="src"><a href="#v:encodeList">encodeList</a> &#8759; [<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r] &#8594; Encoding</p><p class="src"><a href="#v:decodeList">decodeList</a> &#8759; Decoder s [<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r]</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ChainSummary:Rep:6"></span> <span class="keyword">type</span> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r)</span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#line-355" class="link">Source</a> <a href="#t:ChainSummary" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ChainSummary:Rep:6"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html">Ouroboros.Consensus.Storage.LedgerDB.InMemory</a></p> <div class="src"><span class="keyword">type</span> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r) = <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:D1" title="GHC.Generics">D1</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:MetaData" title="GHC.Generics">MetaData</a> &quot;ChainSummary&quot; &quot;Ouroboros.Consensus.Storage.LedgerDB.InMemory&quot; &quot;ouroboros-consensus-0.1.0.0-inplace&quot; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#v:False" title="Data.Bool">False</a>) (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:C1" title="GHC.Generics">C1</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:MetaCons" title="GHC.Generics">MetaCons</a> &quot;ChainSummary&quot; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:PrefixI" title="GHC.Generics">PrefixI</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#v:True" title="Data.Bool">True</a>) (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:S1" title="GHC.Generics">S1</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:MetaSel" title="GHC.Generics">MetaSel</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#v:Just" title="GHC.Maybe">Just</a> &quot;csTip&quot;) <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:NoSourceUnpackedness" title="GHC.Generics">NoSourceUnpackedness</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:SourceStrict" title="GHC.Generics">SourceStrict</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:DecidedStrict" title="GHC.Generics">DecidedStrict</a>) (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rec0" title="GHC.Generics">Rec0</a> (<a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/Cardano-Slotting-Slot.html#t:WithOrigin" title="Cardano.Slotting.Slot">WithOrigin</a> r)) <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t::-42-:" title="GHC.Generics">:*:</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:S1" title="GHC.Generics">S1</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:MetaSel" title="GHC.Generics">MetaSel</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#v:Just" title="GHC.Maybe">Just</a> &quot;csLength&quot;) <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:NoSourceUnpackedness" title="GHC.Generics">NoSourceUnpackedness</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:SourceStrict" title="GHC.Generics">SourceStrict</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:DecidedStrict" title="GHC.Generics">DecidedStrict</a>) (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rec0" title="GHC.Generics">Rec0</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a>) <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t::-42-:" title="GHC.Generics">:*:</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:S1" title="GHC.Generics">S1</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:MetaSel" title="GHC.Generics">MetaSel</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#v:Just" title="GHC.Maybe">Just</a> &quot;csLedger&quot;) <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:NoSourceUnpackedness" title="GHC.Generics">NoSourceUnpackedness</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:SourceStrict" title="GHC.Generics">SourceStrict</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#v:DecidedStrict" title="GHC.Generics">DecidedStrict</a>) (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Generics.html#t:Rec0" title="GHC.Generics">Rec0</a> l))))</div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:encodeChainSummary" class="def">encodeChainSummary</a> &#8759; (l &#8594; Encoding) &#8594; (r &#8594; Encoding) &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r &#8594; Encoding <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#encodeChainSummary" class="link">Source</a> <a href="#v:encodeChainSummary" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:decodeChainSummary" class="def">decodeChainSummary</a> &#8759; (&#8704; s. Decoder s l) &#8594; (&#8704; s. Decoder s r) &#8594; &#8704; s. Decoder s (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r) <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#decodeChainSummary" class="link">Source</a> <a href="#v:decodeChainSummary" class="selflink">#</a></p></div><a href="#g:3" id="g:3"><h2>Queries</h2></a><div class="top"><p class="src"><a id="v:ledgerDbCurrent" class="def">ledgerDbCurrent</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; l <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbCurrent" class="link">Source</a> <a href="#v:ledgerDbCurrent" class="selflink">#</a></p><div class="doc"><p>The ledger state at the tip of the chain</p></div></div><div class="top"><p class="src"><a id="v:ledgerDbTip" class="def">ledgerDbTip</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/Cardano-Slotting-Slot.html#t:WithOrigin" title="Cardano.Slotting.Slot">WithOrigin</a> r <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbTip" class="link">Source</a> <a href="#v:ledgerDbTip" class="selflink">#</a></p><div class="doc"><p>Reference to the block at the tip of the chain</p></div></div><div class="top"><p class="src"><a id="v:ledgerDbAnchor" class="def">ledgerDbAnchor</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:ChainSummary" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ChainSummary</a> l r <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbAnchor" class="link">Source</a> <a href="#v:ledgerDbAnchor" class="selflink">#</a></p><div class="doc"><p>Information about the state of the ledger <em>before</em></p></div></div><a href="#g:4" id="g:4"><h2>Result types</h2></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:PushManyResult" class="def">PushManyResult</a> e l r &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> &#8594; &#9733; <span class="keyword">where</span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#PushManyResult" class="link">Source</a> <a href="#t:PushManyResult" class="selflink">#</a></p><div class="doc"><p>The result of <code>ledgerDbPushMany</code>, i.e. when validating a number of new
 blocks.</p><p>About the boolean type index: if all blocks given to <code>ledgerDbPushMany</code> are
 <code><a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#v:Reapply" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">Reapply</a></code>, and so <code>ap ~ 'True</code>, then the result <em>must</em> be <code><a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#v:ValidBlocks" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ValidBlocks</a></code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:InvalidBlock" class="def">InvalidBlock</a> &#8759; e &#8594; r &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:PushManyResult" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">PushManyResult</a> e l r <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#v:False" title="Data.Bool">False</a></td><td class="doc"><p>A block is invalid. We return the <code><a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a></code> corresponding to the block
 before it. We also return the validation error and include a reference to
 the invalid block.</p></td></tr><tr><td class="src"><a id="v:ValidBlocks" class="def">ValidBlocks</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:PushManyResult" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">PushManyResult</a> e l r ap</td><td class="doc"><p>All blocks were valid, a <code><a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a></code> corresponding to the last valid
 block is returned.</p></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:SwitchResult" class="def">SwitchResult</a> e l r &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> &#8594; &#9733; <span class="keyword">where</span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#SwitchResult" class="link">Source</a> <a href="#t:SwitchResult" class="selflink">#</a></p><div class="doc"><p>The result of <code><a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#v:ledgerDbSwitch" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">ledgerDbSwitch</a></code>, i.e. when validating a fork of the
 current chain.</p><p>First, we roll back <code>m</code> blocks and then apply <code>n</code> new blocks. We do not
 verify in the ledger DB that the new chain is longer; this will be the
 responsibility <code>preferCandidate</code>. Note however that if it is shorter, the
 maximum rollback we can support might be less than <code>k</code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:MaximumRollbackExceeded" class="def">MaximumRollbackExceeded</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a> &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:SwitchResult" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">SwitchResult</a> e l r ap</td><td class="doc"><p>Exceeded maximum rollback supported by the current ledger DB state</p><p>Under normal circumstances this will not arise. It can really only happen
 in the presence of data corruption (or when switching to a shorter fork,
 but that is disallowed by all currently known Ouroboros protocols).</p><p>NOTE: This can happen whether or not the blocks have been previously
 applied, hence this constructor is polymorphic in <code>ap</code>.</p><p>Records both the supported and the requested rollback.</p></td></tr><tr><td class="src"><a id="v:RollbackSuccessful" class="def">RollbackSuccessful</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:PushManyResult" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">PushManyResult</a> e l r ap &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:SwitchResult" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">SwitchResult</a> e l r ap</td><td class="doc"><p>The result of pushing the blocks in the suffix with <code>ledgerDbPushMany</code>.</p></td></tr></table></div></div><a href="#g:5" id="g:5"><h2>Past ledger states</h2></a><div class="top"><p class="src"><a id="v:ledgerDbPast" class="def">ledgerDbPast</a> &#8759; &#8704; m l r b e. (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> r) &#8658; <a href="Ouroboros-Consensus-Storage-LedgerDB-Conf.html#t:LedgerDbConf" title="Ouroboros.Consensus.Storage.LedgerDB.Conf">LedgerDbConf</a> m l r b e &#8594; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/Cardano-Slotting-Slot.html#t:WithOrigin" title="Cardano.Slotting.Slot">WithOrigin</a> r &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; m (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> l) <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbPast" class="link">Source</a> <a href="#v:ledgerDbPast" class="selflink">#</a></p><div class="doc"><p>Get past ledger state</p><p>This may have to re-apply blocks, and hence read from disk.</p></div></div><a href="#g:6" id="g:6"><h2>Updates</h2></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Apply" class="def">Apply</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> &#8594; &#9733; <span class="keyword">where</span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#Apply" class="link">Source</a> <a href="#t:Apply" class="selflink">#</a></p><div class="doc"><p>Has a block previously been applied?</p><p>In addition to the term level value, we also reflect at the type level
 whether the block has been previously applied. This allows us to be more
 precise when we apply blocks: re-applying previously applied blocks cannot
 result in ledger errors.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Reapply" class="def">Reapply</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:Apply" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">Apply</a> pa</td><td class="doc"><p>This block was previously applied</p><p>If we reapply a previously applied block, we <em>must</em> reapply it to the
 very same state. This means that we cannot have any errors.</p><p>This constructor is polymorphic: this allows us to be conservative at
 the type level (&quot;this may result in a ledger error&quot;) whilst still marking
 a block as previously applied (&quot;don't bother checking for errors&quot;). This
 is useful for example when we have a bunch of blocks, some of which have
 been previously applied and some of which have not. Applying all of them
 could definitely result in a ledger error, even if we skip checks for
 some of them.</p></td></tr><tr><td class="src"><a id="v:Apply" class="def">Apply</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:Apply" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">Apply</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#v:False" title="Data.Bool">False</a></td><td class="doc"><p>Not previously applied</p><p>All checks must be performed</p></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">type family</span> <a id="t:Err" class="def">Err</a> (ap &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>) (e &#8759; &#9733;) &#8759; &#9733; <span class="keyword">where ...</span> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#Err" class="link">Source</a> <a href="#t:Err" class="selflink">#</a></p><div class="doc"><p>Error we get from applying a block</p><p>If the block was previously applied, we can't get any errors.</p></div><div class="subs equations"><p class="caption">Equations</p><table><tr><td class="src"><a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:Err" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">Err</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#v:True" title="Data.Bool">True</a> e = <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Void.html#t:Void" title="Data.Void">Void</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:Err" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">Err</a> <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#v:False" title="Data.Bool">False</a> e = e</td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:RefOrVal" class="def">RefOrVal</a> r b <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#RefOrVal" class="link">Source</a> <a href="#t:RefOrVal" class="selflink">#</a></p><div class="doc"><p>Pass a block by value or by reference</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Ref" class="def">Ref</a> r</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:Val" class="def">Val</a> r b</td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><a id="v:ledgerDbPush" class="def">ledgerDbPush</a> &#8759; &#8704; m l r b e ap. <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m &#8658; <a href="Ouroboros-Consensus-Storage-LedgerDB-Conf.html#t:LedgerDbConf" title="Ouroboros.Consensus.Storage.LedgerDB.Conf">LedgerDbConf</a> m l r b e &#8594; (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:Apply" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">Apply</a> ap, <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:RefOrVal" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">RefOrVal</a> r b) &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; m (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Either.html#t:Either" title="Data.Either">Either</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:Err" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">Err</a> ap e) (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r)) <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbPush" class="link">Source</a> <a href="#v:ledgerDbPush" class="selflink">#</a></p><div class="doc"><p>Push a block</p><p><code>O(1)</code>. Computes the new ledger state, and prunes the ledger DB if needed.</p></div></div><div class="top"><p class="src"><a id="v:ledgerDbReapply" class="def">ledgerDbReapply</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m &#8658; <a href="Ouroboros-Consensus-Storage-LedgerDB-Conf.html#t:LedgerDbConf" title="Ouroboros.Consensus.Storage.LedgerDB.Conf">LedgerDbConf</a> m l r b e &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:RefOrVal" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">RefOrVal</a> r b &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; m (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r) <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbReapply" class="link">Source</a> <a href="#v:ledgerDbReapply" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:ledgerDbSwitch" class="def">ledgerDbSwitch</a> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbSwitch" class="link">Source</a> <a href="#v:ledgerDbSwitch" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">&#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8658; <a href="Ouroboros-Consensus-Storage-LedgerDB-Conf.html#t:LedgerDbConf" title="Ouroboros.Consensus.Storage.LedgerDB.Conf">LedgerDbConf</a> m l r b e</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a></td><td class="doc"><p>How many blocks to roll back</p></td></tr><tr><td class="src">&#8594; [(<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:Apply" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">Apply</a> ap, <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:RefOrVal" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">RefOrVal</a> r b)]</td><td class="doc"><p>New blocks to apply</p></td></tr><tr><td class="src">&#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8594; m (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:SwitchResult" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">SwitchResult</a> e l r ap)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Switch to a fork</p></div></div><a href="#g:7" id="g:7"><h1>Exports for the benefit of tests</h1></a><a href="#g:8" id="g:8"><h2>Additional queries</h2></a><div class="top"><p class="src"><a id="v:ledgerDbChainLength" class="def">ledgerDbChainLength</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbChainLength" class="link">Source</a> <a href="#v:ledgerDbChainLength" class="selflink">#</a></p><div class="doc"><p>Total length of the chain (in terms of number of blocks)</p></div></div><div class="top"><p class="src"><a id="v:ledgerDbToList" class="def">ledgerDbToList</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; [(r, <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> l)] <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbToList" class="link">Source</a> <a href="#v:ledgerDbToList" class="selflink">#</a></p><div class="doc"><p>References to blocks and corresponding ledger state (from old to new)</p></div></div><div class="top"><p class="src"><a id="v:ledgerDbMaxRollback" class="def">ledgerDbMaxRollback</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbMaxRollback" class="link">Source</a> <a href="#v:ledgerDbMaxRollback" class="selflink">#</a></p><div class="doc"><p>How many blocks can we currently roll back?</p></div></div><div class="top"><p class="src"><a id="v:ledgerDbSnapshots" class="def">ledgerDbSnapshots</a> &#8759; &#8704; l r. <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; [(<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a>, l)] <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbSnapshots" class="link">Source</a> <a href="#v:ledgerDbSnapshots" class="selflink">#</a></p><div class="doc"><p>All snapshots currently stored by the ledger DB (new to old)</p><p>For each snapshot we also return the distance from the tip</p></div></div><div class="top"><p class="src"><a id="v:ledgerDbIsSaturated" class="def">ledgerDbIsSaturated</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbIsSaturated" class="link">Source</a> <a href="#v:ledgerDbIsSaturated" class="selflink">#</a></p><div class="doc"><p>Have we seen at least <code>k</code> blocks?</p></div></div><div class="top"><p class="src"><a id="v:ledgerDbCountToPrune" class="def">ledgerDbCountToPrune</a> &#8759; <a href="Ouroboros-Consensus-Util-CallStack.html#t:HasCallStack" title="Ouroboros.Consensus.Util.CallStack">HasCallStack</a> &#8658; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDbParams" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDbParams</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbCountToPrune" class="link">Source</a> <a href="#v:ledgerDbCountToPrune" class="selflink">#</a></p><div class="doc"><p>Internal: count number of blocks to prune, given total number of blocks</p><p>This is exposed for the benefit of tests only.</p></div></div><a href="#g:9" id="g:9"><h2>Pure API</h2></a><div class="top"><p class="src"><a id="v:ledgerDbPush-39-" class="def">ledgerDbPush'</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-Conf.html#t:PureLedgerDbConf" title="Ouroboros.Consensus.Storage.LedgerDB.Conf">PureLedgerDbConf</a> l b &#8594; b &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l b &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l b <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbPush%27" class="link">Source</a> <a href="#v:ledgerDbPush-39-" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:ledgerDbPushMany-39-" class="def">ledgerDbPushMany'</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-Conf.html#t:PureLedgerDbConf" title="Ouroboros.Consensus.Storage.LedgerDB.Conf">PureLedgerDbConf</a> l b &#8594; [b] &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l b &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l b <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbPushMany%27" class="link">Source</a> <a href="#v:ledgerDbPushMany-39-" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:ledgerDbSwitch-39-" class="def">ledgerDbSwitch'</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-Conf.html#t:PureLedgerDbConf" title="Ouroboros.Consensus.Storage.LedgerDB.Conf">PureLedgerDbConf</a> l b &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a> &#8594; [b] &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l b &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l b) <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbSwitch%27" class="link">Source</a> <a href="#v:ledgerDbSwitch-39-" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:ledgerDbPast-39-" class="def">ledgerDbPast'</a> &#8759; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> b &#8658; <a href="Ouroboros-Consensus-Storage-LedgerDB-Conf.html#t:PureLedgerDbConf" title="Ouroboros.Consensus.Storage.LedgerDB.Conf">PureLedgerDbConf</a> l b &#8594; <a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/Cardano-Slotting-Slot.html#t:WithOrigin" title="Cardano.Slotting.Slot">WithOrigin</a> b &#8594; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l b &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> l <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbPast%27" class="link">Source</a> <a href="#v:ledgerDbPast-39-" class="selflink">#</a></p></div><a href="#g:10" id="g:10"><h2>Simplifying the result types</h2></a><div class="top"><p class="src"><a id="v:pushManyResultToEither" class="def">pushManyResultToEither</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:PushManyResult" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">PushManyResult</a> e l r ap &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Either.html#t:Either" title="Data.Either">Either</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:Err" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">Err</a> ap e) (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r) <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#pushManyResultToEither" class="link">Source</a> <a href="#v:pushManyResultToEither" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:switchResultToEither" class="def">switchResultToEither</a> &#8759; <a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:SwitchResult" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">SwitchResult</a> e l r ap &#8594; <a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Either.html#t:Either" title="Data.Either">Either</a> (<a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:Err" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">Err</a> ap e)) (<a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#t:LedgerDB" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">LedgerDB</a> l r) <a href="src/Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#switchResultToEither" class="link">Source</a> <a href="#v:switchResultToEither" class="selflink">#</a></p><div class="doc"><p>Translate <code>SwtichResult</code> to <code><a href="file:///opt/ghc/8.6.5/share/doc/ghc-8.6.5/html/libraries/base-4.12.0.0/Data-Either.html#t:Either" title="Data.Either">Either</a></code></p><p>Returns <code>Left Nothing</code> in case of <code><a href="Ouroboros-Consensus-Storage-LedgerDB-InMemory.html#v:MaximumRollbackExceeded" title="Ouroboros.Consensus.Storage.LedgerDB.InMemory">MaximumRollbackExceeded</a></code>. Note that this
 may happen whether or not we have applied the b</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>