<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE GADTs           #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE KindSignatures  #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.HardFork.History.Qry</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-6"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQuery"><span class="hs-identifier hs-var">runQuery</span></a><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQueryThrow"><span class="hs-identifier hs-var">runQueryThrow</span></a><span>
</span><a name="line-9"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQueryPure"><span class="hs-identifier hs-var">runQueryPure</span></a><span>
</span><a name="line-10"></a><span>    </span><span class="hs-comment">-- * Specific queries</span><span>
</span><a name="line-11"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#wallclockToSlot"><span class="hs-identifier hs-var">wallclockToSlot</span></a><span>
</span><a name="line-12"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToWallclock"><span class="hs-identifier hs-var">slotToWallclock</span></a><span>
</span><a name="line-13"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpoch%27"><span class="hs-identifier hs-var">slotToEpoch'</span></a><span>
</span><a name="line-14"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpoch"><span class="hs-identifier hs-var">slotToEpoch</span></a><span>
</span><a name="line-15"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlot%27"><span class="hs-identifier hs-var">epochToSlot'</span></a><span>
</span><a name="line-16"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlot"><span class="hs-identifier hs-var">epochToSlot</span></a><span>
</span><a name="line-17"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Exception</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">throw</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Except</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Bifunctor</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Fixed</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">divMod'</span><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Foldable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">asum</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">toList</span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Time</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">UTCTime</span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Word</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">GHC.Stack</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html"><span class="hs-identifier">Cardano.Slotting.Slot</span></a><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html"><span class="hs-identifier">Ouroboros.Consensus.BlockchainTime.WallClock.Types</span></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Util.IOLike.html"><span class="hs-identifier">Ouroboros.Consensus.Util.IOLike</span></a><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.History.EraParams</span></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.History.Summary</span></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.HardFork.History.Util.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.History.Util</span></a><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  Internal: reified queries

  NOTE. The lower bound of every era is inclusive, while the upper bound is
  really exclusive, making the upper bound of every era equal to the lower
  bound of the next.

  &gt;         era A         era B         era C
  &gt;        [.....) [...............) [..........)
  &gt; epoch         e                 e'
  &gt; slot          s                 s'
  &gt; time          t                 t'

  Now let's consider what happens when we do translations of the values at
  the boundary.

   1. Slot-to-epoch translation. Using era C, we get

      &gt; e' + ((s' - s') / epochSizeC) == e'

      Using era B (technically the wrong era to be using, since the upper bound
      is exclusive), we get

      &gt; e + ((s' - s) / epochSizeB)

      These are equal by (INV-1a).

   2. Epoch-to-slot translation. Using era C, we get

      &gt; s' + ((e' - e') * epochSizeC) == s'

      Using era B, we'd get

      &gt; s + ((e' - e) * epochSizeB

      These are equal by (INV-1b).

   3. Slot to time translation. Using era C, we get

      &gt; t' + ((s' - s') * slotLenC) == t'

      Using era C, we get

      &gt; t + ((s' - s) * slotLenB)

      These are equal by (INV-2b)

   4. Time to slot translation. Using era C, we get

      &gt; s' + ((t' - t') / slotLenC) == s'

      Using era B, we get

      &gt; s + ((t' - t) / slotLenB)

      These are equal by (INV-2a).

  This means that for values at that boundary, it does not matter if we use
  this era or the next era for the translation. However, this is only true for
  these 4 translations. If we are returning the era parameters directly, then
  of course we can't use the era parameters from the wrong era.

  There is however a benefit to using the current era: there might not /be/
  a next era, and so if we use the current era, we extend the period for which
  we do calculations just that tiny bit more. This might be important for
  ledger implementations. For example, suppose we want to know if a particular
  slot @s@ is far enough away from the next epoch boundary (e.g., to determine
  if an update proposal should take effect in this epoch or the next). One
  natural way to write this would be to translate @s@ to the corresponding
  epoch @e@, then translate @e + 1@ back to a slot @s'@, and check the
  distance @s' - s@. However, it is conceivable that the safe zone stops at
  that epoch boundary; if it does, this computation would result in a
  'PastHorizonException', even if a different way to write the same computation
  (translating @s + delta@ to an epoch number, and then comparing that to @e@)
  might succeed. Rather than imposing an unnecessary limitation on the ledger,
  we therefore treat the upper bound as inclusive, so that both ways to do the
  check would succeed.
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-keyword">newtype</span><span> </span><a name="TimeInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier">TimeInEra</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="TimeInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier">TimeInEra</span></a></a><span>   </span><span class="hs-special">{</span><span> </span><a name="getTimeInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getTimeInEra"><span class="hs-identifier">getTimeInEra</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">NominalDiffTime</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-117"></a><span class="hs-keyword">newtype</span><span> </span><a name="TimeInSlot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier">TimeInSlot</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="TimeInSlot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier">TimeInSlot</span></a></a><span>  </span><span class="hs-special">{</span><span> </span><a name="getTimeInSlot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getTimeInSlot"><span class="hs-identifier">getTimeInSlot</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">NominalDiffTime</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-118"></a><span class="hs-keyword">newtype</span><span> </span><a name="SlotInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier">SlotInEra</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="SlotInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier">SlotInEra</span></a></a><span>   </span><span class="hs-special">{</span><span> </span><a name="getSlotInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getSlotInEra"><span class="hs-identifier">getSlotInEra</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-119"></a><span class="hs-keyword">newtype</span><span> </span><a name="SlotInEpoch"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier">SlotInEpoch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="SlotInEpoch"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier">SlotInEpoch</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="getSlotInEpoch"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getSlotInEpoch"><span class="hs-identifier">getSlotInEpoch</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-120"></a><span class="hs-keyword">newtype</span><span> </span><a name="EpochInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier">EpochInEra</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="EpochInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier">EpochInEra</span></a></a><span>  </span><span class="hs-special">{</span><span> </span><a name="getEpochInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getEpochInEra"><span class="hs-identifier">getEpochInEra</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span class="hs-comment">-- | Query</span><span>
</span><a name="line-123"></a><span class="hs-keyword">data</span><span> </span><a name="Qry"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier">Qry</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-124"></a><span>  </span><a name="QPure"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QPure"><span class="hs-identifier">QPure</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679568183"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="#local-6989586621679568183"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-125"></a><span>  </span><a name="QBind"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QBind"><span class="hs-identifier">QBind</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="#local-6989586621679568184"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679568184"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="#local-6989586621679568185"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="#local-6989586621679568185"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span>  </span><span class="hs-comment">-- Convert from absolute to era-relative</span><span>
</span><a name="line-128"></a><span>
</span><a name="line-129"></a><span>  </span><a name="QAbsToRelTime"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QAbsToRelTime"><span class="hs-identifier">QAbsToRelTime</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#RelativeTime"><span class="hs-identifier hs-type">RelativeTime</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-type">TimeInEra</span></a><span>
</span><a name="line-130"></a><span>  </span><a name="QAbsToRelSlot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QAbsToRelSlot"><span class="hs-identifier">QAbsToRelSlot</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a><span>
</span><a name="line-131"></a><span>  </span><a name="QAbsToRelEpoch"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QAbsToRelEpoch"><span class="hs-identifier">QAbsToRelEpoch</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-type">EpochInEra</span></a><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span>  </span><span class="hs-comment">-- Convert from era-relative to absolute</span><span>
</span><a name="line-134"></a><span>
</span><a name="line-135"></a><span>  </span><a name="QRelToAbsTime"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelToAbsTime"><span class="hs-identifier">QRelToAbsTime</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-type">TimeInEra</span></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#RelativeTime"><span class="hs-identifier hs-type">RelativeTime</span></a><span>
</span><a name="line-136"></a><span>  </span><a name="QRelToAbsSlot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelToAbsSlot"><span class="hs-identifier">QRelToAbsSlot</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-type">TimeInSlot</span></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span>
</span><a name="line-137"></a><span>  </span><a name="QRelToAbsEpoch"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelToAbsEpoch"><span class="hs-identifier">QRelToAbsEpoch</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-type">EpochInEra</span></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-type">SlotInEpoch</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span>  </span><span class="hs-comment">-- Convert between relative values</span><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span>  </span><a name="QRelTimeToSlot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelTimeToSlot"><span class="hs-identifier">QRelTimeToSlot</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-type">TimeInEra</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-type">TimeInSlot</span></a><span class="hs-special">)</span><span>
</span><a name="line-142"></a><span>  </span><a name="QRelSlotToTime"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelSlotToTime"><span class="hs-identifier">QRelSlotToTime</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-type">TimeInEra</span></a><span>
</span><a name="line-143"></a><span>  </span><a name="QRelSlotToEpoch"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelSlotToEpoch"><span class="hs-identifier">QRelSlotToEpoch</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-type">EpochInEra</span></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-type">SlotInEpoch</span></a><span class="hs-special">)</span><span>
</span><a name="line-144"></a><span>  </span><a name="QRelEpochToSlot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelEpochToSlot"><span class="hs-identifier">QRelEpochToSlot</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-type">EpochInEra</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span>  </span><span class="hs-comment">-- Get era parameters</span><span>
</span><a name="line-147"></a><span>  </span><span class="hs-comment">-- The arguments are used for bound checks</span><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span>  </span><a name="QSlotLength"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QSlotLength"><span class="hs-identifier">QSlotLength</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#SlotLength"><span class="hs-identifier hs-type">SlotLength</span></a><span>
</span><a name="line-150"></a><span>  </span><a name="QEpochSize"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QEpochSize"><span class="hs-identifier">QEpochSize</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochSize"><span class="hs-identifier hs-type">EpochSize</span></a><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-153"></a><span>  </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-156"></a><span>  </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QPure"><span class="hs-identifier hs-var">QPure</span></a><span>
</span><a name="line-157"></a><span>  </span><span class="hs-special">(</span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ap</span><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-160"></a><span>  </span><a name="local-3458764513820541102"><span class="hs-identifier">return</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span>
</span><a name="line-161"></a><span>  </span><span class="hs-special">(</span><a name="local-3458764513820541099"><span class="hs-operator">&gt;&gt;=</span></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QBind"><span class="hs-identifier hs-var">QBind</span></a><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  Interpreter
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-166"></a><span>
</span><a name="line-167"></a><span class="hs-comment">-- | Evaluate a query in an era</span><span>
</span><a name="line-168"></a><span class="hs-comment">--</span><span>
</span><a name="line-169"></a><span class="hs-comment">-- Returns 'Nothing' if the query is out of bounds in this era.</span><span>
</span><a name="line-170"></a><span class="hs-identifier">evalQryInEra</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-type">EraSummary</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="#local-6989586621679568193"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679568193"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-171"></a><a name="evalQryInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#evalQryInEra"><span class="hs-identifier">evalQryInEra</span></a></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-var">EraSummary</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679568203"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-172"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-173"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#EraParams"><span class="hs-identifier hs-var">EraParams</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679568196"><span class="hs-identifier hs-var">eraParams</span></a><span>
</span><a name="line-174"></a><span>    </span><a name="local-6989586621679568200"><a href="#local-6989586621679568200"><span class="hs-identifier">slotLen</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getSlotLength</span><span> </span><a href="#local-6989586621679568198"><span class="hs-identifier hs-var">eraSlotLength</span></a><span>
</span><a name="line-175"></a><span>    </span><a name="local-6989586621679568201"><a href="#local-6989586621679568201"><span class="hs-identifier">epochSize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unEpochSize</span><span>   </span><a href="#local-6989586621679568197"><span class="hs-identifier hs-var">eraEpochSize</span></a><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span>    </span><span class="hs-identifier">guardEnd</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Bound"><span class="hs-identifier hs-type">Bound</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-178"></a><span>    </span><a name="local-6989586621679568202"><a href="#local-6989586621679568202"><span class="hs-identifier">guardEnd</span></a></a><span> </span><a name="local-6989586621679568205"><a href="#local-6989586621679568205"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-179"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679568195"><span class="hs-identifier hs-var">eraEnd</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-180"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraUnbounded"><span class="hs-identifier hs-var">EraUnbounded</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraEnd"><span class="hs-identifier hs-var">EraEnd</span></a><span> </span><a name="local-6989586621679568206"><a href="#local-6989586621679568206"><span class="hs-identifier">b</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679568205"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679568206"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="#local-6989586621679568204"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679568204"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-184"></a><span>    </span><a name="local-6989586621679568203"><a href="#local-6989586621679568203"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QPure"><span class="hs-identifier hs-var">QPure</span></a><span> </span><a name="local-6989586621679568207"><a href="#local-6989586621679568207"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-185"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679568207"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-186"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QBind"><span class="hs-identifier hs-var">QBind</span></a><span> </span><a name="local-6989586621679568208"><a href="#local-6989586621679568208"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679568209"><a href="#local-6989586621679568209"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-187"></a><span>        </span><a href="#local-6989586621679568203"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679568208"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679568203"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679568209"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-188"></a><span>
</span><a name="line-189"></a><span>    </span><span class="hs-comment">-- Convert absolute to relative</span><span>
</span><a name="line-190"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-191"></a><span>    </span><span class="hs-comment">-- The guards here justify the subtractions.</span><span>
</span><a name="line-192"></a><span>
</span><a name="line-193"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QAbsToRelTime"><span class="hs-identifier hs-var">QAbsToRelTime</span></a><span> </span><a name="local-6989586621679568210"><a href="#local-6989586621679568210"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-194"></a><span>        </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679568210"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-identifier">boundTime</span><span> </span><a href="#local-6989586621679568194"><span class="hs-identifier hs-var">eraStart</span></a><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-var">TimeInEra</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679568210"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">`</span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#diffRelTime"><span class="hs-identifier hs-var">diffRelTime</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">boundTime</span><span> </span><a href="#local-6989586621679568194"><span class="hs-identifier hs-var">eraStart</span></a><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QAbsToRelSlot"><span class="hs-identifier hs-var">QAbsToRelSlot</span></a><span> </span><a name="local-6989586621679568211"><a href="#local-6989586621679568211"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-197"></a><span>        </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679568211"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-identifier">boundSlot</span><span> </span><a href="#local-6989586621679568194"><span class="hs-identifier hs-var">eraStart</span></a><span class="hs-special">)</span><span>
</span><a name="line-198"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-var">SlotInEra</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Util.html#countSlots"><span class="hs-identifier hs-var">countSlots</span></a><span> </span><a href="#local-6989586621679568211"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">boundSlot</span><span> </span><a href="#local-6989586621679568194"><span class="hs-identifier hs-var">eraStart</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QAbsToRelEpoch"><span class="hs-identifier hs-var">QAbsToRelEpoch</span></a><span> </span><a name="local-6989586621679568212"><a href="#local-6989586621679568212"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-200"></a><span>        </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679568212"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-identifier">boundEpoch</span><span> </span><a href="#local-6989586621679568194"><span class="hs-identifier hs-var">eraStart</span></a><span class="hs-special">)</span><span>
</span><a name="line-201"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-var">EpochInEra</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Util.html#countEpochs"><span class="hs-identifier hs-var">countEpochs</span></a><span> </span><a href="#local-6989586621679568212"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">boundEpoch</span><span> </span><a href="#local-6989586621679568194"><span class="hs-identifier hs-var">eraStart</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span>    </span><span class="hs-comment">-- Convert relative to absolute</span><span>
</span><a name="line-204"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-comment">-- As justified by the proof above, the guards treat the upper bound</span><span>
</span><a name="line-206"></a><span>    </span><span class="hs-comment">-- as inclusive.</span><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelToAbsTime"><span class="hs-identifier hs-var">QRelToAbsTime</span></a><span> </span><a name="local-6989586621679568213"><a href="#local-6989586621679568213"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-209"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679568214"><a href="#local-6989586621679568214"><span class="hs-identifier">absTime</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getTimeInEra</span><span> </span><a href="#local-6989586621679568213"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">`</span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#addRelTime"><span class="hs-identifier hs-var">addRelTime</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">boundTime</span><span> </span><a href="#local-6989586621679568194"><span class="hs-identifier hs-var">eraStart</span></a><span>
</span><a name="line-210"></a><span>        </span><a href="#local-6989586621679568202"><span class="hs-identifier hs-var">guardEnd</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679568215"><a href="#local-6989586621679568215"><span class="hs-identifier">end</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679568214"><span class="hs-identifier hs-var">absTime</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-identifier">boundTime</span><span> </span><a href="#local-6989586621679568215"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-211"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679568214"><span class="hs-identifier hs-var">absTime</span></a><span>
</span><a name="line-212"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelToAbsSlot"><span class="hs-identifier hs-var">QRelToAbsSlot</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679568216"><a href="#local-6989586621679568216"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679568217"><a href="#local-6989586621679568217"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-213"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679568218"><a href="#local-6989586621679568218"><span class="hs-identifier">absSlot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Util.html#addSlots"><span class="hs-identifier hs-var">addSlots</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">getSlotInEra</span><span> </span><a href="#local-6989586621679568216"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">boundSlot</span><span> </span><a href="#local-6989586621679568194"><span class="hs-identifier hs-var">eraStart</span></a><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span>        </span><a href="#local-6989586621679568202"><span class="hs-identifier hs-var">guardEnd</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679568219"><a href="#local-6989586621679568219"><span class="hs-identifier">end</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679568218"><span class="hs-identifier hs-var">absSlot</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span>  </span><span class="hs-identifier">boundSlot</span><span> </span><a href="#local-6989586621679568219"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-215"></a><span>                        </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679568218"><span class="hs-identifier hs-var">absSlot</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">boundSlot</span><span> </span><a href="#local-6989586621679568219"><span class="hs-identifier hs-var">end</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier">getTimeInSlot</span><span> </span><a href="#local-6989586621679568217"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-216"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679568218"><span class="hs-identifier hs-var">absSlot</span></a><span>
</span><a name="line-217"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelToAbsEpoch"><span class="hs-identifier hs-var">QRelToAbsEpoch</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679568220"><a href="#local-6989586621679568220"><span class="hs-identifier">e</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679568221"><a href="#local-6989586621679568221"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-218"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679568222"><a href="#local-6989586621679568222"><span class="hs-identifier">absEpoch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Util.html#addEpochs"><span class="hs-identifier hs-var">addEpochs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">getEpochInEra</span><span> </span><a href="#local-6989586621679568220"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">boundEpoch</span><span> </span><a href="#local-6989586621679568194"><span class="hs-identifier hs-var">eraStart</span></a><span class="hs-special">)</span><span>
</span><a name="line-219"></a><span>        </span><a href="#local-6989586621679568202"><span class="hs-identifier hs-var">guardEnd</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679568223"><a href="#local-6989586621679568223"><span class="hs-identifier">end</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679568222"><span class="hs-identifier hs-var">absEpoch</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span>  </span><span class="hs-identifier">boundEpoch</span><span> </span><a href="#local-6989586621679568223"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-220"></a><span>                        </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679568222"><span class="hs-identifier hs-var">absEpoch</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">boundEpoch</span><span> </span><a href="#local-6989586621679568223"><span class="hs-identifier hs-var">end</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier">getSlotInEpoch</span><span> </span><a href="#local-6989586621679568221"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-221"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679568222"><span class="hs-identifier hs-var">absEpoch</span></a><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span>    </span><span class="hs-comment">-- Convert between relative values</span><span>
</span><a name="line-224"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-225"></a><span>    </span><span class="hs-comment">-- No guards necessary</span><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelTimeToSlot"><span class="hs-identifier hs-var">QRelTimeToSlot</span></a><span> </span><a name="local-6989586621679568224"><a href="#local-6989586621679568224"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-228"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">bimap</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-var">SlotInEra</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-var">TimeInSlot</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">getTimeInEra</span><span> </span><a href="#local-6989586621679568224"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">divMod'</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679568200"><span class="hs-identifier hs-var">slotLen</span></a><span class="hs-special">)</span><span>
</span><a name="line-229"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelSlotToTime"><span class="hs-identifier hs-var">QRelSlotToTime</span></a><span> </span><a name="local-6989586621679568225"><a href="#local-6989586621679568225"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-230"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-var">TimeInEra</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">getSlotInEra</span><span> </span><a href="#local-6989586621679568225"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679568200"><span class="hs-identifier hs-var">slotLen</span></a><span class="hs-special">)</span><span>
</span><a name="line-231"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelSlotToEpoch"><span class="hs-identifier hs-var">QRelSlotToEpoch</span></a><span> </span><a name="local-6989586621679568226"><a href="#local-6989586621679568226"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-232"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">bimap</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-var">EpochInEra</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-var">SlotInEpoch</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">getSlotInEra</span><span> </span><a href="#local-6989586621679568226"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">divMod</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679568201"><span class="hs-identifier hs-var">epochSize</span></a><span>
</span><a name="line-233"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelEpochToSlot"><span class="hs-identifier hs-var">QRelEpochToSlot</span></a><span> </span><a name="local-6989586621679568227"><a href="#local-6989586621679568227"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-234"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-var">SlotInEra</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">getEpochInEra</span><span> </span><a href="#local-6989586621679568227"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679568201"><span class="hs-identifier hs-var">epochSize</span></a><span class="hs-special">)</span><span>
</span><a name="line-235"></a><span>
</span><a name="line-236"></a><span>    </span><span class="hs-comment">-- Get era parameters</span><span>
</span><a name="line-237"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-238"></a><span>    </span><span class="hs-comment">-- Here the upper bound must definitely be exclusive, or we'd return the</span><span>
</span><a name="line-239"></a><span>    </span><span class="hs-comment">-- era parameters from the wrong era.</span><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QSlotLength"><span class="hs-identifier hs-var">QSlotLength</span></a><span> </span><a name="local-6989586621679568228"><a href="#local-6989586621679568228"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-242"></a><span>        </span><span class="hs-identifier hs-var">guard</span><span>    </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679568228"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-identifier">boundSlot</span><span> </span><a href="#local-6989586621679568194"><span class="hs-identifier hs-var">eraStart</span></a><span>
</span><a name="line-243"></a><span>        </span><a href="#local-6989586621679568202"><span class="hs-identifier hs-var">guardEnd</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679568229"><a href="#local-6989586621679568229"><span class="hs-identifier">end</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679568228"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-identifier">boundSlot</span><span> </span><a href="#local-6989586621679568229"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-244"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679568198"><span class="hs-identifier hs-var">eraSlotLength</span></a><span>
</span><a name="line-245"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QEpochSize"><span class="hs-identifier hs-var">QEpochSize</span></a><span> </span><a name="local-6989586621679568230"><a href="#local-6989586621679568230"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-246"></a><span>        </span><span class="hs-identifier hs-var">guard</span><span>    </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679568230"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-identifier">boundEpoch</span><span> </span><a href="#local-6989586621679568194"><span class="hs-identifier hs-var">eraStart</span></a><span>
</span><a name="line-247"></a><span>        </span><a href="#local-6989586621679568202"><span class="hs-identifier hs-var">guardEnd</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679568231"><a href="#local-6989586621679568231"><span class="hs-identifier">end</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679568230"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-identifier">boundEpoch</span><span> </span><a href="#local-6989586621679568231"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-248"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679568197"><span class="hs-identifier hs-var">eraEpochSize</span></a><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  Very thin layer for dealing running queries
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-253"></a><span>
</span><a name="line-254"></a><span class="hs-identifier">runQuery</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="#local-6989586621679568191"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-type">Summary</span></a><span> </span><a href="#local-6989586621679568192"><span class="hs-identifier hs-type">xs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#PastHorizonException"><span class="hs-identifier hs-type">PastHorizonException</span></a><span> </span><a href="#local-6989586621679568191"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-255"></a><a name="runQuery"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQuery"><span class="hs-identifier">runQuery</span></a></a><span> </span><a name="local-6989586621679568232"><a href="#local-6989586621679568232"><span class="hs-identifier">qry</span></a></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-var">Summary</span></a><span> </span><a name="local-6989586621679568233"><a href="#local-6989586621679568233"><span class="hs-identifier">summary</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-256"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">asum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">flip</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#evalQryInEra"><span class="hs-identifier hs-var">evalQryInEra</span></a><span> </span><a href="#local-6989586621679568232"><span class="hs-identifier hs-var">qry</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679568234"><span class="hs-identifier hs-var">eras</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-257"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679568235"><a href="#local-6989586621679568235"><span class="hs-identifier">answer</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679568235"><span class="hs-identifier hs-var">answer</span></a><span>
</span><a name="line-258"></a><span>      </span><span class="hs-identifier hs-var">Nothing</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#PastHorizon"><span class="hs-identifier hs-var">PastHorizon</span></a><span> </span><span class="hs-identifier hs-var">callStack</span><span> </span><a href="#local-6989586621679568234"><span class="hs-identifier hs-var">eras</span></a><span>
</span><a name="line-259"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-260"></a><span>    </span><span class="hs-identifier">eras</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-type">EraSummary</span></a><span class="hs-special">]</span><span>
</span><a name="line-261"></a><span>    </span><a name="local-6989586621679568234"><a href="#local-6989586621679568234"><span class="hs-identifier">eras</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679568233"><span class="hs-identifier hs-var">summary</span></a><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span class="hs-identifier">runQueryThrow</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HasCallStack</span><span class="hs-special">,</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/src/Control.Monad.Class.MonadThrow.html#MonadThrow"><span class="hs-identifier hs-type">MonadThrow</span></a><span> </span><a href="#local-6989586621679568188"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">)</span><span class="hs-glyph">=&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="#local-6989586621679568189"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-type">Summary</span></a><span> </span><a href="#local-6989586621679568190"><span class="hs-identifier hs-type">xs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679568188"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679568189"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-264"></a><a name="runQueryThrow"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQueryThrow"><span class="hs-identifier">runQueryThrow</span></a></a><span> </span><a name="local-6989586621679568236"><a href="#local-6989586621679568236"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">either</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/src/Control.Monad.Class.MonadThrow.html#throwM"><span class="hs-identifier hs-var">throwM</span></a><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQuery"><span class="hs-identifier hs-var">runQuery</span></a><span> </span><a href="#local-6989586621679568236"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span class="hs-identifier">runQueryPure</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="#local-6989586621679568186"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-type">Summary</span></a><span> </span><a href="#local-6989586621679568187"><span class="hs-identifier hs-type">xs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679568186"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-267"></a><a name="runQueryPure"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQueryPure"><span class="hs-identifier">runQueryPure</span></a></a><span> </span><a name="local-6989586621679568237"><a href="#local-6989586621679568237"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">either</span><span> </span><span class="hs-identifier hs-var">throw</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQuery"><span class="hs-identifier hs-var">runQuery</span></a><span> </span><a href="#local-6989586621679568237"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  Specific queries

  The primed forms are the ones used in the 'EpochInfo' construction.
  Critically, they do not ask for any of the era parameters. This means that
  their valid range /includes/ the end bound.
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-276"></a><span>
</span><a name="line-277"></a><span class="hs-comment">-- | Translate 'UTCTime' to 'SlotNo'</span><span>
</span><a name="line-278"></a><span class="hs-comment">--</span><span>
</span><a name="line-279"></a><span class="hs-comment">-- Additionally returns the time spent and time left in this slot.</span><span>
</span><a name="line-280"></a><span class="hs-identifier">wallclockToSlot</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#RelativeTime"><span class="hs-identifier hs-type">RelativeTime</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">NominalDiffTime</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">NominalDiffTime</span><span class="hs-special">)</span><span>
</span><a name="line-281"></a><a name="wallclockToSlot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#wallclockToSlot"><span class="hs-identifier">wallclockToSlot</span></a></a><span> </span><a name="local-6989586621679568238"><a href="#local-6989586621679568238"><span class="hs-identifier">absTime</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-282"></a><span>    </span><a name="local-6989586621679568239"><a href="#local-6989586621679568239"><span class="hs-identifier">relTime</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QAbsToRelTime"><span class="hs-identifier hs-var">QAbsToRelTime</span></a><span>  </span><a href="#local-6989586621679568238"><span class="hs-identifier hs-var">absTime</span></a><span>
</span><a name="line-283"></a><span>    </span><a name="local-6989586621679568240"><a href="#local-6989586621679568240"><span class="hs-identifier">relSlot</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelTimeToSlot"><span class="hs-identifier hs-var">QRelTimeToSlot</span></a><span> </span><a href="#local-6989586621679568239"><span class="hs-identifier hs-var">relTime</span></a><span>
</span><a name="line-284"></a><span>    </span><a name="local-6989586621679568241"><a href="#local-6989586621679568241"><span class="hs-identifier">absSlot</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelToAbsSlot"><span class="hs-identifier hs-var">QRelToAbsSlot</span></a><span>  </span><a href="#local-6989586621679568240"><span class="hs-identifier hs-var">relSlot</span></a><span>
</span><a name="line-285"></a><span>    </span><a name="local-6989586621679568242"><a href="#local-6989586621679568242"><span class="hs-identifier">slotLen</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QSlotLength"><span class="hs-identifier hs-var">QSlotLength</span></a><span>    </span><a href="#local-6989586621679568241"><span class="hs-identifier hs-var">absSlot</span></a><span>
</span><a name="line-286"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679568243"><a href="#local-6989586621679568243"><span class="hs-identifier">timeInSlot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getTimeInSlot</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679568240"><span class="hs-identifier hs-var">relSlot</span></a><span class="hs-special">)</span><span>
</span><a name="line-287"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-288"></a><span>        </span><a href="#local-6989586621679568241"><span class="hs-identifier hs-var">absSlot</span></a><span>
</span><a name="line-289"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679568243"><span class="hs-identifier hs-var">timeInSlot</span></a><span>
</span><a name="line-290"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">getSlotLength</span><span> </span><a href="#local-6989586621679568242"><span class="hs-identifier hs-var">slotLen</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679568243"><span class="hs-identifier hs-var">timeInSlot</span></a><span>
</span><a name="line-291"></a><span>      </span><span class="hs-special">)</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-comment">-- | Translate 'SlotNo' to the 'UTCTime' at the start of that slot</span><span>
</span><a name="line-294"></a><span class="hs-comment">--</span><span>
</span><a name="line-295"></a><span class="hs-comment">-- Additionally returns the length of the slot.</span><span>
</span><a name="line-296"></a><span class="hs-identifier">slotToWallclock</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#RelativeTime"><span class="hs-identifier hs-type">RelativeTime</span></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#SlotLength"><span class="hs-identifier hs-type">SlotLength</span></a><span class="hs-special">)</span><span>
</span><a name="line-297"></a><a name="slotToWallclock"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToWallclock"><span class="hs-identifier">slotToWallclock</span></a></a><span> </span><a name="local-6989586621679568244"><a href="#local-6989586621679568244"><span class="hs-identifier">absSlot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-298"></a><span>    </span><a name="local-6989586621679568245"><a href="#local-6989586621679568245"><span class="hs-identifier">relSlot</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QAbsToRelSlot"><span class="hs-identifier hs-var">QAbsToRelSlot</span></a><span>  </span><a href="#local-6989586621679568244"><span class="hs-identifier hs-var">absSlot</span></a><span>
</span><a name="line-299"></a><span>    </span><a name="local-6989586621679568246"><a href="#local-6989586621679568246"><span class="hs-identifier">relTime</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelSlotToTime"><span class="hs-identifier hs-var">QRelSlotToTime</span></a><span> </span><a href="#local-6989586621679568245"><span class="hs-identifier hs-var">relSlot</span></a><span>
</span><a name="line-300"></a><span>    </span><a name="local-6989586621679568247"><a href="#local-6989586621679568247"><span class="hs-identifier">absTime</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelToAbsTime"><span class="hs-identifier hs-var">QRelToAbsTime</span></a><span>  </span><a href="#local-6989586621679568246"><span class="hs-identifier hs-var">relTime</span></a><span>
</span><a name="line-301"></a><span>    </span><a name="local-6989586621679568248"><a href="#local-6989586621679568248"><span class="hs-identifier">slotLen</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QSlotLength"><span class="hs-identifier hs-var">QSlotLength</span></a><span>    </span><a href="#local-6989586621679568244"><span class="hs-identifier hs-var">absSlot</span></a><span>
</span><a name="line-302"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679568247"><span class="hs-identifier hs-var">absTime</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679568248"><span class="hs-identifier hs-var">slotLen</span></a><span class="hs-special">)</span><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span class="hs-comment">-- | Convert 'SlotNo' to 'EpochNo' and the relative slot within the epoch</span><span>
</span><a name="line-305"></a><span class="hs-identifier">slotToEpoch'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span>
</span><a name="line-306"></a><a name="slotToEpoch%27"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpoch%27"><span class="hs-identifier">slotToEpoch'</span></a></a><span> </span><a name="local-6989586621679568249"><a href="#local-6989586621679568249"><span class="hs-identifier">absSlot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-307"></a><span>    </span><a name="local-6989586621679568250"><a href="#local-6989586621679568250"><span class="hs-identifier">relSlot</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QAbsToRelSlot"><span class="hs-identifier hs-var">QAbsToRelSlot</span></a><span>   </span><a href="#local-6989586621679568249"><span class="hs-identifier hs-var">absSlot</span></a><span>
</span><a name="line-308"></a><span>    </span><a name="local-6989586621679568251"><a href="#local-6989586621679568251"><span class="hs-identifier">epochSlot</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelSlotToEpoch"><span class="hs-identifier hs-var">QRelSlotToEpoch</span></a><span> </span><a href="#local-6989586621679568250"><span class="hs-identifier hs-var">relSlot</span></a><span>
</span><a name="line-309"></a><span>    </span><a name="local-6989586621679568252"><a href="#local-6989586621679568252"><span class="hs-identifier">absEpoch</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelToAbsEpoch"><span class="hs-identifier hs-var">QRelToAbsEpoch</span></a><span>  </span><a href="#local-6989586621679568251"><span class="hs-identifier hs-var">epochSlot</span></a><span>
</span><a name="line-310"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679568252"><span class="hs-identifier hs-var">absEpoch</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">getSlotInEpoch</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679568251"><span class="hs-identifier hs-var">epochSlot</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-311"></a><span>
</span><a name="line-312"></a><span class="hs-comment">-- | Translate 'SlotNo' to its corresponding 'EpochNo'</span><span>
</span><a name="line-313"></a><span class="hs-comment">--</span><span>
</span><a name="line-314"></a><span class="hs-comment">-- Additionally returns the relative slot within this epoch and how many</span><span>
</span><a name="line-315"></a><span class="hs-comment">-- slots are left in this slot.</span><span>
</span><a name="line-316"></a><span class="hs-identifier">slotToEpoch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span>
</span><a name="line-317"></a><a name="slotToEpoch"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpoch"><span class="hs-identifier">slotToEpoch</span></a></a><span> </span><a name="local-6989586621679568253"><a href="#local-6989586621679568253"><span class="hs-identifier">absSlot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-318"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679568254"><a href="#local-6989586621679568254"><span class="hs-identifier">absEpoch</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679568255"><a href="#local-6989586621679568255"><span class="hs-identifier">slotInEpoch</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpoch%27"><span class="hs-identifier hs-var">slotToEpoch'</span></a><span> </span><a href="#local-6989586621679568253"><span class="hs-identifier hs-var">absSlot</span></a><span>
</span><a name="line-319"></a><span>    </span><a name="local-6989586621679568256"><a href="#local-6989586621679568256"><span class="hs-identifier">epochSize</span></a></a><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QEpochSize"><span class="hs-identifier hs-var">QEpochSize</span></a><span> </span><a href="#local-6989586621679568254"><span class="hs-identifier hs-var">absEpoch</span></a><span>
</span><a name="line-320"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679568254"><span class="hs-identifier hs-var">absEpoch</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679568255"><span class="hs-identifier hs-var">slotInEpoch</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">unEpochSize</span><span> </span><a href="#local-6989586621679568256"><span class="hs-identifier hs-var">epochSize</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679568255"><span class="hs-identifier hs-var">slotInEpoch</span></a><span class="hs-special">)</span><span>
</span><a name="line-321"></a><span>
</span><a name="line-322"></a><span class="hs-identifier">epochToSlot'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span>
</span><a name="line-323"></a><a name="epochToSlot%27"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlot%27"><span class="hs-identifier">epochToSlot'</span></a></a><span> </span><a name="local-6989586621679568257"><a href="#local-6989586621679568257"><span class="hs-identifier">absEpoch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-324"></a><span>    </span><a name="local-6989586621679568258"><a href="#local-6989586621679568258"><span class="hs-identifier">relEpoch</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QAbsToRelEpoch"><span class="hs-identifier hs-var">QAbsToRelEpoch</span></a><span>  </span><a href="#local-6989586621679568257"><span class="hs-identifier hs-var">absEpoch</span></a><span>
</span><a name="line-325"></a><span>    </span><a name="local-6989586621679568259"><a href="#local-6989586621679568259"><span class="hs-identifier">slotInEra</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelEpochToSlot"><span class="hs-identifier hs-var">QRelEpochToSlot</span></a><span> </span><a href="#local-6989586621679568258"><span class="hs-identifier hs-var">relEpoch</span></a><span>
</span><a name="line-326"></a><span>    </span><a name="local-6989586621679568260"><a href="#local-6989586621679568260"><span class="hs-identifier">absSlot</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QRelToAbsSlot"><span class="hs-identifier hs-var">QRelToAbsSlot</span></a><span>   </span><span class="hs-special">(</span><a href="#local-6989586621679568259"><span class="hs-identifier hs-var">slotInEra</span></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-var">TimeInSlot</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-327"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679568260"><span class="hs-identifier hs-var">absSlot</span></a><span>
</span><a name="line-328"></a><span>
</span><a name="line-329"></a><span class="hs-comment">-- | Translate 'EpochNo' to the 'SlotNo' of the first slot in that epoch</span><span>
</span><a name="line-330"></a><span class="hs-comment">--</span><span>
</span><a name="line-331"></a><span class="hs-comment">-- Additionally returns the size of the epoch.</span><span>
</span><a name="line-332"></a><span class="hs-identifier">epochToSlot</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span class="hs-special">,</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochSize"><span class="hs-identifier hs-type">EpochSize</span></a><span class="hs-special">)</span><span>
</span><a name="line-333"></a><a name="epochToSlot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlot"><span class="hs-identifier">epochToSlot</span></a></a><span> </span><a name="local-6989586621679568261"><a href="#local-6989586621679568261"><span class="hs-identifier">absEpoch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlot%27"><span class="hs-identifier hs-var">epochToSlot'</span></a><span> </span><a href="#local-6989586621679568261"><span class="hs-identifier hs-var">absEpoch</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QEpochSize"><span class="hs-identifier hs-var">QEpochSize</span></a><span> </span><a href="#local-6989586621679568261"><span class="hs-identifier hs-var">absEpoch</span></a><span>
</span><a name="line-334"></a></pre></body></html>